@page "/Auth/Register"
@model CareSync.Pages.Auth.RegisterModel
@{
    ViewData["Title"] = "Register";
    Layout = "Layouts/_AuthLayout";
}

<!-- Form starts -->
<form method="post">
    <div class="auth-box">
        <a href="/" class="auth-logo mb-4">
            <img src="~/theme/images/logo.svg" alt="CareSync">
        </a>

        <h4 class="mb-4">Create Account</h4>
        <p class="text-muted mb-4">Join CareSync to manage your healthcare journey.</p>

        @if (!string.IsNullOrEmpty(Model.SuccessMessage))
        {
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <i class="ri-check-circle-line me-2"></i>
                @Model.SuccessMessage
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        }

        @if (!string.IsNullOrEmpty(Model.ErrorMessage))
        {
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="ri-error-warning-line me-2"></i>
                @Model.ErrorMessage
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        }

        <div asp-validation-summary="All" class="text-danger mb-3"></div>

        <!-- Personal Information Section -->
        <div class="form-section mb-4">
            <h6 class="form-section-title mb-3">
                <i class="ri-user-line me-2"></i>Personal Information
            </h6>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label" asp-for="RegisterRequest.FirstName">
                        <i class="ri-user-line me-1"></i>First Name <span class="text-danger">*</span>
                    </label>
                    <input type="text" asp-for="RegisterRequest.FirstName" class="form-control" 
                           placeholder="Enter your first name" autocomplete="given-name">
                    <span asp-validation-for="RegisterRequest.FirstName" class="text-danger"></span>
                </div>
                
                <div class="col-md-6 mb-3">
                    <label class="form-label" asp-for="RegisterRequest.LastName">
                        <i class="ri-user-line me-1"></i>Last Name
                    </label>
                    <input type="text" asp-for="RegisterRequest.LastName" class="form-control" 
                           placeholder="Enter your last name" autocomplete="family-name">
                    <span asp-validation-for="RegisterRequest.LastName" class="text-danger"></span>
                </div>
            </div>
            
            <div class="mb-3">
                <label class="form-label" asp-for="RegisterRequest.ArabicUserName">
                    <i class="ri-translate-2 me-1"></i>Arabic Name <span class="text-danger">*</span>
                </label>
                <input type="text" asp-for="RegisterRequest.ArabicUserName" class="form-control" 
                       placeholder="اكتب اسمك بالعربية" dir="rtl">
                <span asp-validation-for="RegisterRequest.ArabicUserName" class="text-danger"></span>
            </div>
        </div>

        <!-- Account Information Section -->
        <div class="form-section mb-4">
            <h6 class="form-section-title mb-3">
                <i class="ri-account-circle-line me-2"></i>Account Information
            </h6>
            
            <div class="mb-3">
                <label class="form-label" asp-for="RegisterRequest.UserName">
                    <i class="ri-at-line me-1"></i>Username <span class="text-danger">*</span>
                </label>
                <input type="text" asp-for="RegisterRequest.UserName" class="form-control" 
                       placeholder="Choose a unique username" autocomplete="username">
                <small class="form-text text-muted">This will be your unique identifier in the system</small>
                <span asp-validation-for="RegisterRequest.UserName" class="text-danger"></span>
            </div>

            <div class="mb-3">
                <label class="form-label" asp-for="RegisterRequest.Email">
                    <i class="ri-mail-line me-1"></i>Email Address <span class="text-danger">*</span>
                </label>
                <input type="email" asp-for="RegisterRequest.Email" class="form-control" 
                       placeholder="Enter your email address" autocomplete="email">
                <span asp-validation-for="RegisterRequest.Email" class="text-danger"></span>
            </div>

            <div class="mb-3">
                <label class="form-label" asp-for="RegisterRequest.PhoneNumber">
                    <i class="ri-phone-line me-1"></i>Phone Number
                </label>
                <input type="tel" asp-for="RegisterRequest.PhoneNumber" class="form-control" 
                       placeholder="Enter your phone number" autocomplete="tel">
                <span asp-validation-for="RegisterRequest.PhoneNumber" class="text-danger"></span>
            </div>
        </div>

        <!-- Personal Details Section -->
        <div class="form-section mb-4">
            <h6 class="form-section-title mb-3">
                <i class="ri-information-line me-2"></i>Personal Details
            </h6>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label" asp-for="RegisterRequest.Gender">
                        <i class="ri-user-2-line me-1"></i>Gender <span class="text-danger">*</span>
                    </label>
                    <select asp-for="RegisterRequest.Gender" class="form-select">
                        <option value="">Select Gender</option>
                        <option value="1">Male</option>
                        <option value="2">Female</option>
                        <option value="3">Other</option>
                    </select>
                    <span asp-validation-for="RegisterRequest.Gender" class="text-danger"></span>
                </div>
                
                <div class="col-md-6 mb-3">
                    <label class="form-label" asp-for="RegisterRequest.DateOfBirth">
                        <i class="ri-calendar-line me-1"></i>Date of Birth
                    </label>
                    <input type="date" asp-for="RegisterRequest.DateOfBirth" class="form-control" 
                           onchange="calculateAge()" autocomplete="bday">
                    <span asp-validation-for="RegisterRequest.DateOfBirth" class="text-danger"></span>
                </div>
            </div>
            
            <div class="mb-3">
                <label class="form-label" asp-for="RegisterRequest.Age">
                    <i class="ri-time-line me-1"></i>Age
                </label>
                <input type="number" asp-for="RegisterRequest.Age" class="form-control" 
                       placeholder="Age will be calculated automatically" readonly>
                <span asp-validation-for="RegisterRequest.Age" class="text-danger"></span>
            </div>

            <div class="mb-3">
                <label class="form-label" asp-for="RegisterRequest.Address">
                    <i class="ri-map-pin-line me-1"></i>Address
                </label>
                <textarea asp-for="RegisterRequest.Address" class="form-control" rows="3" 
                          placeholder="Enter your full address" autocomplete="street-address"></textarea>
                <span asp-validation-for="RegisterRequest.Address" class="text-danger"></span>
            </div>
        </div>

        <!-- Security Section -->
        <div class="form-section mb-4">
            <h6 class="form-section-title mb-3">
                <i class="ri-shield-keyhole-line me-2"></i>Security
            </h6>
            
            <div class="mb-3">
                <label class="form-label" asp-for="RegisterRequest.Password">
                    <i class="ri-lock-line me-1"></i>Password <span class="text-danger">*</span>
                </label>
                <div class="input-group">
                    <input type="password" asp-for="RegisterRequest.Password" id="password" class="form-control" 
                           placeholder="Create a strong password" autocomplete="new-password">
                    <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordField('password', this)">
                        <i class="ri-eye-line text-primary"></i>
                    </button>
                </div>
                <div class="password-strength mt-2">
                    <div class="progress" style="height: 4px;">
                        <div class="progress-bar" id="passwordStrength" role="progressbar" style="width: 0%"></div>
                    </div>
                    <small class="form-text text-muted">Password must be at least 6 characters long</small>
                </div>
                <span asp-validation-for="RegisterRequest.Password" class="text-danger"></span>
            </div>

            <div class="mb-3">
                <label class="form-label" asp-for="RegisterRequest.ConfirmPassword">
                    <i class="ri-lock-2-line me-1"></i>Confirm Password <span class="text-danger">*</span>
                </label>
                <div class="input-group">
                    <input type="password" asp-for="RegisterRequest.ConfirmPassword" id="confirmPassword" class="form-control" 
                           placeholder="Confirm your password" autocomplete="new-password">
                    <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordField('confirmPassword', this)">
                        <i class="ri-eye-line text-primary"></i>
                    </button>
                </div>
                <span asp-validation-for="RegisterRequest.ConfirmPassword" class="text-danger"></span>
            </div>
            
            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" asp-for="RegisterRequest.TwoFactorEnabled" id="twoFactor">
                <label class="form-check-label" for="twoFactor">
                    <i class="ri-shield-check-line me-1"></i>Enable Two-Factor Authentication (Recommended)
                </label>
            </div>
        </div>

        <!-- Terms and Submit -->
        <div class="mb-3">
            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="termsCheck" required>
                <label class="form-check-label" for="termsCheck">
                    I agree to the <a href="#" class="text-primary">Terms of Service</a> and 
                    <a href="#" class="text-primary">Privacy Policy</a> <span class="text-danger">*</span>
                </label>
            </div>
            
            <div class="d-grid gap-2 mb-3">
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="ri-user-add-line me-2"></i>Create Account
                </button>
            </div>
        </div>
        
        <div class="text-center">
            <p class="mb-0">Already have an account? 
                <a href="/Auth/Login" class="text-primary text-decoration-underline fw-semibold">
                    Sign In
                </a>
            </p>
        </div>
    </div>
</form>
<!-- Form ends -->

@section Scripts {
    <script>
        function calculateAge() {
            const dob = document.querySelector('[name="RegisterRequest.DateOfBirth"]').value;
            if (dob) {
                const birthDate = new Date(dob);
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const m = today.getMonth() - birthDate.getMonth();
                if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                document.querySelector('[name="RegisterRequest.Age"]').value = age;
            }
        }
        
        function togglePasswordField(fieldId, button) {
            const field = document.getElementById(fieldId);
            const icon = button.querySelector('i');
            
            if (field.type === 'password') {
                field.type = 'text';
                icon.className = 'ri-eye-off-line text-primary';
            } else {
                field.type = 'password';
                icon.className = 'ri-eye-line text-primary';
            }
        }
        
        function checkPasswordStrength() {
            const password = document.getElementById('password').value;
            const strengthBar = document.getElementById('passwordStrength');
            let strength = 0;
            
            if (password.length >= 6) strength += 25;
            if (password.match(/[a-z]/)) strength += 25;
            if (password.match(/[A-Z]/)) strength += 25;
            if (password.match(/[0-9]/) || password.match(/[^a-zA-Z0-9]/)) strength += 25;
            
            strengthBar.style.width = strength + '%';
            
            if (strength < 50) {
                strengthBar.className = 'progress-bar bg-danger';
            } else if (strength < 75) {
                strengthBar.className = 'progress-bar bg-warning';
            } else {
                strengthBar.className = 'progress-bar bg-success';
            }
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('password').addEventListener('input', checkPasswordStrength);
            document.getElementById('RegisterRequest_FirstName').focus();
        });
    </script>
    
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
