@page "/Admin/Reports/Lab"
@model CareSync.Pages.Admin.LabReportsModel
@{
    ViewData["Title"] = "Lab Reports";
}

@section PageActions {
    <div class="d-flex gap-2">
        <button class="btn btn-outline-primary" onclick="exportReport('pdf')">
            <i class="ri-file-pdf-line me-2"></i>Export PDF
        </button>
        <button class="btn btn-outline-success" onclick="exportReport('excel')">
            <i class="ri-file-excel-line me-2"></i>Export Excel
        </button>
    </div>
}

<!-- Report Filters -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="ri-filter-line me-2"></i>Report Filters
                </h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">Date Range</label>
                        <input type="text" class="form-control" id="dateRange" placeholder="Select date range">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Test Type</label>
                        <select class="form-select">
                            <option value="">All Tests</option>
                            <option value="blood">Blood Tests</option>
                            <option value="urine">Urine Analysis</option>
                            <option value="imaging">Imaging</option>
                            <option value="biopsy">Biopsy</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Lab Department</label>
                        <select class="form-select">
                            <option value="">All Labs</option>
                            <option value="hematology">Hematology</option>
                            <option value="biochemistry">Biochemistry</option>
                            <option value="microbiology">Microbiology</option>
                            <option value="radiology">Radiology</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Status</label>
                        <select class="form-select">
                            <option value="">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="in-progress">In Progress</option>
                            <option value="completed">Completed</option>
                            <option value="reviewed">Reviewed</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">&nbsp;</label>
                        <button class="btn btn-primary w-100">
                            <i class="ri-search-line me-2"></i>Generate Report
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Summary Cards -->
<div class="row mb-4">
    <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
        <div class="card border-primary">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="ri-test-tube-line text-primary" style="font-size: 2rem;"></i>
                </div>
                <h3 class="card-title text-primary">2,847</h3>
                <p class="card-text text-muted">Total Lab Tests</p>
                <small class="text-success">+12.5% from last month</small>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
        <div class="card border-success">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="ri-checkbox-circle-line text-success" style="font-size: 2rem;"></i>
                </div>
                <h3 class="card-title text-success">2,456</h3>
                <p class="card-text text-muted">Completed</p>
                <small class="text-success">86.3% completion rate</small>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
        <div class="card border-warning">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="ri-time-line text-warning" style="font-size: 2rem;"></i>
                </div>
                <h3 class="card-title text-warning">234</h3>
                <p class="card-text text-muted">Pending</p>
                <small class="text-warning">8.2% pending tests</small>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
        <div class="card border-info">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="ri-hourglass-line text-info" style="font-size: 2rem;"></i>
                </div>
                <h3 class="card-title text-info">2.4</h3>
                <p class="card-text text-muted">Avg. Processing Time</p>
                <small class="text-info">Hours per test</small>
            </div>
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="row mb-4">
    <div class="col-xl-8 col-lg-7">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="ri-line-chart-line me-2"></i>Lab Test Volume Trends
                </h5>
            </div>
            <div class="card-body">
                <div class="chart-container" style="height: 300px;">
                    <canvas id="labVolumeChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-4 col-lg-5">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="ri-donut-chart-line me-2"></i>Test Type Distribution
                </h5>
            </div>
            <div class="card-body">
                <div class="chart-container" style="height: 300px;">
                    <canvas id="testTypeChart"></canvas>
                </div>
                <div class="mt-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="d-flex align-items-center">
                            <span class="badge bg-primary me-2">&nbsp;</span>Blood Tests
                        </span>
                        <span class="fw-bold">1,456 (51.1%)</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="d-flex align-items-center">
                            <span class="badge bg-success me-2">&nbsp;</span>Urine Analysis
                        </span>
                        <span class="fw-bold">678 (23.8%)</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="d-flex align-items-center">
                            <span class="badge bg-info me-2">&nbsp;</span>Imaging
                        </span>
                        <span class="fw-bold">456 (16.0%)</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="d-flex align-items-center">
                            <span class="badge bg-warning me-2">&nbsp;</span>Others
                        </span>
                        <span class="fw-bold">257 (9.0%)</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Lab Department Performance -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="ri-building-2-line me-2"></i>Lab Department Performance
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Department</th>
                                <th>Total Tests</th>
                                <th>Completed</th>
                                <th>Pending</th>
                                <th>Avg. Processing Time</th>
                                <th>Completion Rate</th>
                                <th>Quality Score</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="icon-box sm bg-primary-subtle rounded me-2">
                                            <i class="ri-drop-line text-primary"></i>
                                        </div>
                                        <span class="fw-semibold">Hematology</span>
                                    </div>
                                </td>
                                <td>856</td>
                                <td><span class="text-success fw-bold">798</span></td>
                                <td><span class="text-warning">58</span></td>
                                <td>2.1 hrs</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="progress me-2" style="width: 100px; height: 8px;">
                                            <div class="progress-bar bg-success" style="width: 93%"></div>
                                        </div>
                                        <span class="text-success fw-bold">93.2%</span>
                                    </div>
                                </td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="rating-stars me-2">
                                            <i class="ri-star-fill text-warning"></i>
                                            <i class="ri-star-fill text-warning"></i>
                                            <i class="ri-star-fill text-warning"></i>
                                            <i class="ri-star-fill text-warning"></i>
                                            <i class="ri-star-fill text-warning"></i>
                                        </div>
                                        <span class="fw-bold">4.8</span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="icon-box sm bg-success-subtle rounded me-2">
                                            <i class="ri-flask-line text-success"></i>
                                        </div>
                                        <span class="fw-semibold">Biochemistry</span>
                                    </div>
                                </td>
                                <td>724</td>
                                <td><span class="text-success fw-bold">656</span></td>
                                <td><span class="text-warning">68</span></td>
                                <td>2.8 hrs</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="progress me-2" style="width: 100px; height: 8px;">
                                            <div class="progress-bar bg-success" style="width: 91%"></div>
                                        </div>
                                        <span class="text-success fw-bold">90.6%</span>
                                    </div>
                                </td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="rating-stars me-2">
                                            <i class="ri-star-fill text-warning"></i>
                                            <i class="ri-star-fill text-warning"></i>
                                            <i class="ri-star-fill text-warning"></i>
                                            <i class="ri-star-fill text-warning"></i>
                                            <i class="ri-star-line text-muted"></i>
                                        </div>
                                        <span class="fw-bold">4.5</span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="icon-box sm bg-info-subtle rounded me-2">
                                            <i class="ri-microscope-line text-info"></i>
                                        </div>
                                        <span class="fw-semibold">Microbiology</span>
                                    </div>
                                </td>
                                <td>456</td>
                                <td><span class="text-success fw-bold">398</span></td>
                                <td><span class="text-warning">58</span></td>
                                <td>3.2 hrs</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="progress me-2" style="width: 100px; height: 8px;">
                                            <div class="progress-bar bg-success" style="width: 87%"></div>
                                        </div>
                                        <span class="text-success fw-bold">87.3%</span>
                                    </div>
                                </td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="rating-stars me-2">
                                            <i class="ri-star-fill text-warning"></i>
                                            <i class="ri-star-fill text-warning"></i>
                                            <i class="ri-star-fill text-warning"></i>
                                            <i class="ri-star-fill text-warning"></i>
                                            <i class="ri-star-line text-muted"></i>
                                        </div>
                                        <span class="fw-bold">4.3</span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Detailed Lab Report -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <div class="d-flex align-items-center justify-content-between">
                    <h5 class="card-title mb-0">
                        <i class="ri-table-line me-2"></i>Detailed Lab Test Report
                    </h5>
                    <div class="d-flex gap-2">
                        <input type="text" class="form-control form-control-sm" placeholder="Search tests..." style="width: 200px;">
                        <button class="btn btn-sm btn-outline-primary">
                            <i class="ri-search-line"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Test ID</th>
                                <th>Patient</th>
                                <th>Test Type</th>
                                <th>Department</th>
                                <th>Requested Date</th>
                                <th>Completed Date</th>
                                <th>Processing Time</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge bg-light text-dark">LAB001</span></td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <img src="~/theme/images/users/1.jpg" class="img-2x rounded-circle me-2" alt="Patient">
                                        <div>
                                            <h6 class="mb-0">John Smith</h6>
                                            <small class="text-muted">ID: PAT001</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div>
                                        <span class="fw-semibold">Complete Blood Count</span><br>
                                        <small class="text-muted">CBC with Differential</small>
                                    </div>
                                </td>
                                <td><span class="badge bg-primary-subtle text-primary">Hematology</span></td>
                                <td>Nov 14, 2024<br><small class="text-muted">9:00 AM</small></td>
                                <td>Nov 14, 2024<br><small class="text-muted">11:30 AM</small></td>
                                <td><span class="badge bg-success-subtle text-success">2.5 hrs</span></td>
                                <td><span class="badge bg-success">Completed</span></td>
                                <td>
                                    <div class="d-flex gap-1">
                                        <button class="btn btn-sm btn-outline-primary" data-bs-toggle="tooltip" title="View Report">
                                            <i class="ri-eye-line"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-success" data-bs-toggle="tooltip" title="Download">
                                            <i class="ri-download-line"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-light text-dark">LAB002</span></td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <img src="~/theme/images/users/2.jpg" class="img-2x rounded-circle me-2" alt="Patient">
                                        <div>
                                            <h6 class="mb-0">Emma Wilson</h6>
                                            <small class="text-muted">ID: PAT002</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div>
                                        <span class="fw-semibold">Liver Function Test</span><br>
                                        <small class="text-muted">LFT Panel</small>
                                    </div>
                                </td>
                                <td><span class="badge bg-success-subtle text-success">Biochemistry</span></td>
                                <td>Nov 14, 2024<br><small class="text-muted">10:15 AM</small></td>
                                <td>-</td>
                                <td><span class="badge bg-warning-subtle text-warning">In Progress</span></td>
                                <td><span class="badge bg-warning">Processing</span></td>
                                <td>
                                    <div class="d-flex gap-1">
                                        <button class="btn btn-sm btn-outline-primary" data-bs-toggle="tooltip" title="View Status">
                                            <i class="ri-eye-line"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-info" data-bs-toggle="tooltip" title="Update Status">
                                            <i class="ri-edit-line"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                <nav aria-label="Page navigation" class="mt-4">
                    <ul class="pagination justify-content-center">
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1">Previous</a>
                        </li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item">
                            <a class="page-link" href="#">Next</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function exportReport(format) {
            alert(`Exporting lab report in ${format.toUpperCase()} format...`);
            // Implementation for export functionality
        }

        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });

        // Sample chart initialization
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Lab Reports page loaded - Charts can be initialized here');
        });
    </script>
}
