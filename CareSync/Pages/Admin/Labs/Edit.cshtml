@page "/Admin/Labs/Edit"
@model CareSync.Pages.Admin.Labs.EditModel
@{
    ViewData["Title"] = "Edit Laboratory";
}

<div class="container-fluid">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h4 class="mb-1">
                        <i class="ri-edit-line me-2"></i>Edit Laboratory
                    </h4>
                    <p class="text-muted mb-0">Update laboratory information</p>
                </div>
                <div class="d-flex gap-2">
                    <a href="~/Admin/Labs/Details?labId=@Model.Lab.LabId" class="btn btn-outline-info">
                        <i class="ri-eye-line me-1"></i>View Details
                    </a>
                    <a href="~/Admin/Labs/ManageLabs" class="btn btn-outline-secondary">
                        <i class="ri-arrow-left-line me-1"></i>Back to Labs
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Lab Form -->
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <form method="post" id="editLabForm">
                <input type="hidden" asp-for="Lab.LabId" />
                
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="card-title mb-0">
                            <i class="ri-information-line me-2"></i>Laboratory Information
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Basic Information -->
                        <div class="row g-3 mb-4">
                            <div class="col-12">
                                <h6 class="text-primary border-bottom pb-2">
                                    <i class="ri-building-2-line me-2"></i>Basic Information
                                </h6>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="Lab.LabName" class="form-label">
                                    Laboratory Name <span class="text-danger">*</span>
                                </label>
                                <input asp-for="Lab.LabName" class="form-control" placeholder="e.g., City Medical Lab" required />
                                <span asp-validation-for="Lab.LabName" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="Lab.ArabicLabName" class="form-label">Arabic Lab Name</label>
                                <input asp-for="Lab.ArabicLabName" class="form-control" placeholder="الاسم بالعربية" dir="rtl" />
                                <span asp-validation-for="Lab.ArabicLabName" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="Lab.LicenseNumber" class="form-label">License Number</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="ri-file-list-3-line"></i></span>
                                    <input asp-for="Lab.LicenseNumber" class="form-control" placeholder="LAB-2024-001" />
                                </div>
                                <span asp-validation-for="Lab.LicenseNumber" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="Lab.Location" class="form-label">Location / City</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="ri-map-pin-line"></i></span>
                                    <input asp-for="Lab.Location" class="form-control" placeholder="e.g., Downtown, Riyadh" />
                                </div>
                                <span asp-validation-for="Lab.Location" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Address Information -->
                        <div class="row g-3 mb-4">
                            <div class="col-12">
                                <h6 class="text-primary border-bottom pb-2">
                                    <i class="ri-map-line me-2"></i>Address Information
                                </h6>
                            </div>

                            <div class="col-12">
                                <label asp-for="Lab.LabAddress" class="form-label">Lab Address</label>
                                <textarea asp-for="Lab.LabAddress" class="form-control" rows="2" placeholder="Enter full address"></textarea>
                                <span asp-validation-for="Lab.LabAddress" class="text-danger"></span>
                            </div>

                            <div class="col-12">
                                <label asp-for="Lab.ArabicLabAddress" class="form-label">Arabic Lab Address</label>
                                <textarea asp-for="Lab.ArabicLabAddress" class="form-control" rows="2" placeholder="العنوان بالعربية" dir="rtl"></textarea>
                                <span asp-validation-for="Lab.ArabicLabAddress" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="row g-3 mb-4">
                            <div class="col-12">
                                <h6 class="text-primary border-bottom pb-2">
                                    <i class="ri-contacts-line me-2"></i>Contact Information
                                </h6>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="Lab.ContactNumber" class="form-label">Contact Number</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="ri-phone-line"></i></span>
                                    <input asp-for="Lab.ContactNumber" class="form-control" placeholder="+966 50 123 4567" />
                                </div>
                                <span asp-validation-for="Lab.ContactNumber" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="Lab.Email" class="form-label">Email Address</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="ri-mail-line"></i></span>
                                    <input asp-for="Lab.Email" class="form-control" placeholder="info@lab.com" />
                                </div>
                                <span asp-validation-for="Lab.Email" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Operating Hours -->
                        <div class="row g-3">
                            <div class="col-12">
                                <h6 class="text-primary border-bottom pb-2">
                                    <i class="ri-time-line me-2"></i>Operating Hours
                                </h6>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="Lab.OpeningTime" class="form-label">Opening Time</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="ri-sun-line"></i></span>
                                    <input asp-for="Lab.OpeningTime" type="time" class="form-control" />
                                </div>
                                <span asp-validation-for="Lab.OpeningTime" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="Lab.ClosingTime" class="form-label">Closing Time</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="ri-moon-line"></i></span>
                                    <input asp-for="Lab.ClosingTime" type="time" class="form-control" />
                                </div>
                                <span asp-validation-for="Lab.ClosingTime" class="text-danger"></span>
                            </div>

                            <div class="col-12">
                                <small class="text-muted">
                                    <i class="ri-information-line me-1"></i>
                                    Leave times empty if operating 24/7
                                </small>
                            </div>
                        </div>
                    </div>

                    <div class="card-footer">
                        <div class="d-flex justify-content-between">
                            <a href="~/Admin/Labs/ManageLabs" class="btn btn-secondary">
                                <i class="ri-close-line me-1"></i>Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="ri-save-line me-1"></i>Update Laboratory
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    
    <script>
        // Show error toast if there's an error message
        @if (!string.IsNullOrEmpty(Model.ErrorMessage))
        {
            <text>
            toast.error('@Html.Raw(System.Text.Encodings.Web.JavaScriptEncoder.Default.Encode(Model.ErrorMessage))', 'Error');
            </text>
        }

        // Form validation
        document.getElementById('editLabForm').addEventListener('submit', function(e) {
            const labName = document.getElementById('Lab_LabName').value.trim();
            
            if (!labName) {
                e.preventDefault();
                alert('Laboratory name is required.');
                return false;
            }

            // Validate opening/closing time logic
            const openingTime = document.getElementById('Lab_OpeningTime').value;
            const closingTime = document.getElementById('Lab_ClosingTime').value;

            if (openingTime && closingTime && openingTime >= closingTime) {
                e.preventDefault();
                alert('Closing time must be after opening time.');
                return false;
            }

            return true;
        });

        // Auto-format phone number
        const phoneInput = document.getElementById('Lab_ContactNumber');
        if (phoneInput) {
            phoneInput.addEventListener('blur', function() {
                let value = this.value.replace(/\D/g, '');
                if (value.length > 0) {
                    if (!value.startsWith('966')) {
                        value = '966' + value;
                    }
                    this.value = '+' + value;
                }
            });
        }
    </script>
}
