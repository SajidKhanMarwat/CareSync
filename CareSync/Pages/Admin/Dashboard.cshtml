@page "/Admin/Dashboard"
@model CareSync.Pages.Admin.DashboardModel
@{
    ViewData["Title"] = "Admin Dashboard";
}

@* @section PageActions {
    <button class="btn btn-primary">
        <i class="ri-add-line me-2"></i>Quick Action
    </button>
} *@

@if (Model.HasError)
{
    <div class="row mb-3">
        <div class="col-12">
            <div class="alert alert-danger border-0 shadow-sm d-flex align-items-center" role="alert">
                <i class="ri-error-warning-line fs-4 me-3"></i>
                <div class="flex-grow-1">
                    <strong>Error:</strong> @Model.ErrorMessage
                </div>
            </div>
        </div>
    </div>
}

<!-- Critical Alerts & Notifications -->
@if (Model.UrgentItems != null && Model.UrgentItems.Any())
{
    <div class="row mb-3">
        <div class="col-12">
            <div class="alert alert-warning border-0 shadow-sm d-flex align-items-center" role="alert">
                <i class="ri-alarm-warning-line fs-4 me-3"></i>
                <div class="flex-grow-1">
                    <strong>@Model.UrgentItems.Count Urgent Item@(Model.UrgentItems.Count > 1 ? "s" : "")</strong> require your attention.
                    @foreach (var item in Model.UrgentItems.Take(3))
                    {
                        <span class="d-block small mt-1">@item.Message</span>
                    }
                </div>
                <a href="#urgent-items-section" class="btn btn-sm btn-warning">Review Now</a>
            </div>
        </div>
    </div>
}

<!-- Welcome Section -->
<div class="row mb-4">
    <div class="col-12">
        <div class="welcome-header mb-3">
            <div class="d-flex align-items-center justify-content-between flex-wrap">
                <div>
                    <h3 class="mb-1 fw-bold">Welcome back, @User.Identity?.Name! ðŸ‘‹</h3>
                    <p class="text-muted mb-0">Here's what's happening at CareSync today.</p>
                </div>
                <div class="text-end">
                    <small class="text-muted d-block">Current Time</small>
                    <span class="fw-semibold">@DateTime.Now.ToString("MMM dd, yyyy h:mm tt")</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Statistics Cards - Theme Design -->
<div class="row g-4 mb-4">
    <div class="col-sm-4 col-12">
        <div class="card mb-3 shadow-sm border-0 h-100">
            <div class="card-body p-4">
                <div class="d-flex align-items-center">
                    <div class="p-2 border border-primary rounded-circle me-3">
                        <div class="icon-box md bg-primary-lighten rounded-5">
                            <i class="ri-calendar-check-line fs-4 text-primary"></i>
                        </div>
                    </div>
                    <div class="d-flex flex-column">
                        <h1 class="lh-1">@(Model.DashboardStats?.TotalAppointments ?? 0)</h1>
                        <p class="m-0">Appointments</p>
                    </div>
                </div>
                <div class="d-flex align-items-end justify-content-between mt-3">
                    <a class="text-primary" href="~/Admin/Appointments/AppointmentsList">
                        <span>View All</span>
                        <i class="ri-arrow-right-line text-primary ms-1"></i>
                    </a>
                    <div class="text-end">
                        @if (Model.DashboardStats != null)
                        {
                            var percent = Model.DashboardStats.ThisVsLastMonthPercentageAppointment;
                            var isPositive = percent >= 0;
                            <p class="mb-0 @(isPositive ? "text-success" : "text-danger")">
                                @(isPositive ? "+" : "")@percent.ToString("F1")%
                            </p>
                            <span class="badge @(isPositive ? "bg-success-light text-success" : "bg-danger-light text-danger") small">this month</span>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm-4 col-12">
        <div class="card mb-3 shadow-sm border-0 h-100">
            <div class="card-body p-4">
                <div class="d-flex align-items-center">
                    <div class="p-2 border border-primary rounded-circle me-3">
                        <div class="icon-box md bg-primary-lighten rounded-5">
                            <i class="ri-stethoscope-line fs-4 text-primary"></i>
                        </div>
                    </div>
                    <div class="d-flex flex-column">
                        <h1 class="lh-1">@(Model.DashboardStats?.TotalDoctors ?? 0)</h1>
                        <p class="m-0">Doctors</p>
                    </div>
                </div>
                <div class="d-flex align-items-end justify-content-between mt-3">
                    <a class="text-primary" href="~/Admin/Doctors/DoctorsList">
                        <span>View All</span>
                        <i class="ri-arrow-right-line ms-1"></i>
                    </a>
                    <div class="text-end">
                        @if (Model.DashboardStats != null)
                        {
                            var percent = Model.DashboardStats.ThisVsLastMonthPercentageDoctors;
                            var isPositive = percent >= 0;
                            <p class="mb-0 @(isPositive ? "text-success" : "text-danger")">
                                @(isPositive ? "+" : "")@percent.ToString("F1")%
                            </p>
                            <span class="badge @(isPositive ? "bg-success-light text-success" : "bg-danger-light text-danger") small">this month</span>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm-4 col-12">
        <div class="card mb-3 shadow-sm border-0 h-100">
            <div class="card-body p-4">
                <div class="d-flex align-items-center">
                    <div class="p-2 border border-primary rounded-circle me-3">
                        <div class="icon-box md bg-primary-lighten rounded-5">
                            <i class="ri-user-heart-line fs-4 text-primary"></i>
                        </div>
                    </div>
                    <div class="d-flex flex-column">
                        <h1 class="lh-1">@(Model.DashboardStats?.TotalPatients ?? 0)</h1>
                        <p class="m-0">Patients</p>
                    </div>
                </div>
                <div class="d-flex align-items-end justify-content-between mt-3">
                    <a class="text-primary" href="~/Admin/Patients/PatientsList">
                        <span>View All</span>
                        <i class="ri-arrow-right-line text-primary ms-1"></i>
                    </a>
                    <div class="text-end">
                        @if (Model.DashboardStats != null)
                        {
                            var percent = Model.DashboardStats.ThisVsLastMonthPercentagePatients;
                            var isPositive = percent >= 0;
                            <p class="mb-0 @(isPositive ? "text-success" : "text-danger")">
                                @(isPositive ? "+" : "")@percent.ToString("F1")%
                            </p>
                            <span class="badge @(isPositive ? "bg-success-light text-success" : "bg-danger-light text-danger") small">this month</span>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions Row -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-white border-bottom py-3">
                <h5 class="card-title mb-0 fw-semibold">
                    <i class="ri-flashlight-line me-2 text-primary"></i>Quick Actions
                </h5>
            </div>
            <div class="card-body p-4">
                <div class="row g-3">
                    <div class="col-md-2">
                        <a href="~/Patients/Create" class="btn btn-outline-primary w-100 d-flex flex-column align-items-center py-3 quick-action-btn">
                            <i class="ri-user-add-line mb-2" style="font-size: 1.5rem;"></i>
                            <span>Add Patient</span>
                        </a>
                    </div>
                    <div class="col-md-2">
                        <a href="~/Admin/Doctors/Create" class="btn btn-outline-success w-100 d-flex flex-column align-items-center py-3 quick-action-btn">
                            <i class="ri-user-star-line mb-2" style="font-size: 1.5rem;"></i>
                            <span>Add Doctor</span>
                        </a>
                    </div>
                    <div class="col-md-2">
                        <a href="~/Admin/Labs/CreateLabStaff" class="btn btn-outline-info w-100 d-flex flex-column align-items-center py-3 quick-action-btn">
                            <i class="ri-test-tube-line mb-2" style="font-size: 1.5rem;"></i>
                            <span>Add Lab Staff</span>
                        </a>
                    </div>
                    <div class="col-md-2">
                        <a href="~/Admin/UserReports" class="btn btn-outline-warning w-100 d-flex flex-column align-items-center py-3 quick-action-btn">
                            <i class="ri-file-chart-line mb-2" style="font-size: 1.5rem;"></i>
                            <span>View Reports</span>
                        </a>
                    </div>
                    <div class="col-md-2">
                        <a href="~/Admin/Labs/StaffList" class="btn btn-outline-secondary w-100 d-flex flex-column align-items-center py-3 quick-action-btn">
                            <i class="ri-team-line mb-2" style="font-size: 1.5rem;"></i>
                            <span>Manage Staff</span>
                        </a>
                    </div>
                    <div class="col-md-2">
                        <a href="~/Admin/Patients/Search" class="btn btn-outline-dark w-100 d-flex flex-column align-items-center py-3 quick-action-btn">
                            <i class="ri-search-line mb-2" style="font-size: 1.5rem;"></i>
                            <span>Search Patients</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Doctor Availability & Performance Metrics -->
<div class="row mb-4">
    <div class="col-xl-4 col-lg-6 mb-3">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white border-bottom py-3 d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0 fw-semibold">
                    <i class="ri-user-star-line me-2 text-primary"></i>Doctor Availability
                </h5>
                @if (Model.DoctorAvailability != null)
                {
                    <div class="text-end">
                        <small class="text-muted d-block">Available: @Model.DoctorAvailability.TotalAvailable</small>
                        <small class="text-muted">In Session: @Model.DoctorAvailability.InSession</small>
                    </div>
                }
            </div>
            <div class="card-body p-4">
                @if (Model.DoctorAvailability != null && Model.DoctorAvailability.Doctors.Any())
                {
                    <div class="doctor-status-list">
                        @foreach (var doctor in Model.DoctorAvailability.Doctors.Take(6))
                        {
                            var statusClass = doctor.Status switch
                            {
                                "Available" => "status-available",
                                "InSession" => "status-busy",
                                "OnBreak" => "status-break",
                                "Off" => "status-off",
                                _ => "status-available"
                            };
                            var badgeClass = doctor.Status switch
                            {
                                "Available" => "bg-success-subtle text-success",
                                "InSession" => "bg-warning-subtle text-warning",
                                "OnBreak" => "bg-info-subtle text-info",
                                "Off" => "bg-secondary-subtle text-secondary",
                                _ => "bg-success-subtle text-success"
                            };
                            var statusText = doctor.Status switch
                            {
                                "InSession" => "In Session",
                                "OnBreak" => "On Break",
                                _ => doctor.Status
                            };

                            <div class="d-flex align-items-center justify-content-between mb-3 pb-3 border-bottom">
                                <div class="d-flex align-items-center">
                                    <div class="status-indicator @statusClass me-2"></div>
                                    <div>
                                        <h6 class="mb-0">@doctor.DoctorName</h6>
                                        <small class="text-muted">@doctor.Specialization</small>
                                        @if (doctor.TodaysAppointmentCount > 0)
                                        {
                                            <small class="d-block text-muted">
                                                @doctor.TodaysAppointmentCount appointment(s) today
                                            </small>
                                        }
                                    </div>
                                </div>
                                <span class="badge @badgeClass">@statusText</span>
                            </div>
                        }
                        @if (Model.DoctorAvailability.Doctors.Count > 6)
                        {
                            <div class="text-center mt-3">
                                <a href="~/Admin/Doctors/DoctorsList" class="btn btn-sm btn-outline-primary">
                                    View All Doctors (@Model.DoctorAvailability.Doctors.Count)
                                </a>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <div class="text-center py-4">
                        <i class="ri-user-star-line text-muted" style="font-size: 3rem;"></i>
                        <p class="text-muted mb-0">No doctors available</p>
                        <a href="~/Admin/Doctors/Create" class="btn btn-sm btn-primary mt-2">
                            <i class="ri-add-line me-1"></i>Add Doctor
                        </a>
                    </div>
                }
            </div>
        </div>
    </div>
    
    <div class="col-xl-4 col-lg-6 mb-3">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white border-bottom py-3">
                <h5 class="card-title mb-0 fw-semibold">
                    <i class="ri-line-chart-line me-2 text-primary"></i>Today's Performance
                </h5>
            </div>
            <div class="card-body p-4">
                @if (Model.TodayPerformanceMetrics != null)
                {
                    <div class="metric-item mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="text-muted">Patient Check-ins</span>
                            <span class="fw-bold text-primary">@Model.TodayPerformanceMetrics.CheckedInToday / @Model.TodayPerformanceMetrics.TotalScheduledToday</span>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-primary" role="progressbar" style="width: @(Model.TodayPerformanceMetrics.CheckInPercentage)%"></div>
                        </div>
                        <small class="text-muted">@Model.TodayPerformanceMetrics.CheckInPercentage% checked in</small>
                    </div>
                    <div class="metric-item mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="text-muted">Appointments Completed</span>
                            <span class="fw-bold text-success">@Model.TodayPerformanceMetrics.CompletedAppointments / @Model.TodayPerformanceMetrics.TotalAppointmentsToday</span>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: @(Model.TodayPerformanceMetrics.CompletionPercentage)%"></div>
                        </div>
                        <small class="text-muted">@Model.TodayPerformanceMetrics.CompletionPercentage% completion rate</small>
                    </div>
                    @if (Model.TodayPerformanceMetrics.TotalLabReportsRequested > 0)
                    {
                        <div class="metric-item mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="text-muted">Lab Reports Ready</span>
                                <span class="fw-bold text-info">@Model.TodayPerformanceMetrics.LabReportsReady / @Model.TodayPerformanceMetrics.TotalLabReportsRequested</span>
                            </div>
                            <div class="progress" style="height: 8px;">
                                <div class="progress-bar bg-info" role="progressbar" style="width: @(Model.TodayPerformanceMetrics.LabReportsPercentage)%"></div>
                            </div>
                            <small class="text-muted">@Model.TodayPerformanceMetrics.LabReportsPercentage% ready</small>
                        </div>
                    }
                    <div class="metric-item">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="text-muted">Revenue Today</span>
                            <span class="fw-bold text-success">$@Model.TodayPerformanceMetrics.RevenueToday.ToString("N2")</span>
                        </div>
                        @if (Model.TodayPerformanceMetrics.IsRevenueAboveAverage)
                        {
                            <small class="text-success">
                                <i class="ri-arrow-up-line"></i> @Model.TodayPerformanceMetrics.RevenuePercentageChange.ToString("F1")% above average
                            </small>
                        }
                        else
                        {
                            <small class="text-danger">
                                <i class="ri-arrow-down-line"></i> @Model.TodayPerformanceMetrics.RevenuePercentageChange.ToString("F1")% below average
                            </small>
                        }
                    </div>
                }
                else
                {
                    <div class="text-center py-4">
                        <i class="ri-line-chart-line text-muted" style="font-size: 3rem;"></i>
                        <p class="text-muted mb-0">No performance data available</p>
                    </div>
                }
            </div>
        </div>
    </div>
    
    <div class="col-xl-4 col-lg-12 mb-3">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white border-bottom py-3">
                <h5 class="card-title mb-0 fw-semibold">
                    <i class="ri-time-line me-2 text-primary"></i>Recent Activity
                </h5>
            </div>
            <div class="card-body p-4">
                <div class="activity-timeline">
                    @if (Model.TodayPerformanceMetrics != null)
                    {
                        @if (Model.TodayPerformanceMetrics.NewPatientsToday > 0)
                        {
                            <div class="activity-item">
                                <div class="activity-icon bg-success-subtle">
                                    <i class="ri-user-add-line text-success"></i>
                                </div>
                                <div class="activity-content">
                                    <p class="mb-0"><strong>@Model.TodayPerformanceMetrics.NewPatientsToday New Patient(s)</strong> registered today</p>
                                    <small class="text-muted">Latest registration @DateTime.Now.AddHours(-1).ToString("h:mm tt")</small>
                                </div>
                            </div>
                        }
                        @if (Model.TodayPerformanceMetrics.CompletedAppointments > 0)
                        {
                            <div class="activity-item">
                                <div class="activity-icon bg-primary-subtle">
                                    <i class="ri-calendar-check-line text-primary"></i>
                                </div>
                                <div class="activity-content">
                                    <p class="mb-0"><strong>@Model.TodayPerformanceMetrics.CompletedAppointments Appointment(s)</strong> completed</p>
                                    <small class="text-muted">@Model.TodayPerformanceMetrics.CompletionPercentage% completion rate today</small>
                                </div>
                            </div>
                        }
                        @if (Model.TodayPerformanceMetrics.LabReportsReady > 0)
                        {
                            <div class="activity-item">
                                <div class="activity-icon bg-info-subtle">
                                    <i class="ri-test-tube-line text-info"></i>
                                </div>
                                <div class="activity-content">
                                    <p class="mb-0"><strong>@Model.TodayPerformanceMetrics.LabReportsReady Lab Report(s)</strong> ready</p>
                                    <small class="text-muted">Out of @Model.TodayPerformanceMetrics.TotalLabReportsRequested requested today</small>
                                </div>
                            </div>
                        }
                        @if (Model.TodayPerformanceMetrics.PendingAppointments > 0)
                        {
                            <div class="activity-item">
                                <div class="activity-icon bg-warning-subtle">
                                    <i class="ri-time-line text-warning"></i>
                                </div>
                                <div class="activity-content">
                                    <p class="mb-0"><strong>@Model.TodayPerformanceMetrics.PendingAppointments Appointment(s)</strong> pending</p>
                                    <small class="text-muted">Awaiting confirmation</small>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="text-center py-4">
                            <i class="ri-time-line text-muted" style="font-size: 2rem;"></i>
                            <p class="text-muted mb-0">No recent activity</p>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<!-- User Distribution & Monthly Statistics -->
<div class="row mb-4">
    <div class="col-xl-6 col-lg-6 mb-3">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white border-bottom py-3">
                <h5 class="card-title mb-0 fw-semibold">
                    <i class="ri-pie-chart-line me-2 text-primary"></i>User Distribution
                </h5>
            </div>
            <div class="card-body p-4">
                @if (Model.UserDistribution != null)
                {
                    <div class="row g-3">
                        <!-- Patients -->
                        <div class="col-6">
                            <div class="text-center p-3 border rounded-3 bg-light">
                                <div class="mb-2">
                                    <i class="ri-user-heart-line text-primary" style="font-size: 2rem;"></i>
                                </div>
                                <h4 class="text-primary">@Model.UserDistribution.Patients.TotalCount.ToString("N0")</h4>
                                <p class="mb-0 text-muted">Patients</p>
                                <small class="@(Model.UserDistribution.Patients.PercentageChange >= 0 ? "text-success" : "text-danger")">
                                    @(Model.UserDistribution.Patients.PercentageChange >= 0 ? "+" : "")@Model.UserDistribution.Patients.PercentageChange.ToString("F1")% from last month
                                </small>
                            </div>
                        </div>
                        
                        <!-- Doctors -->
                        <div class="col-6">
                            <div class="text-center p-3 border rounded-3 bg-light">
                                <div class="mb-2">
                                    <i class="ri-user-star-line text-success" style="font-size: 2rem;"></i>
                                </div>
                                <h4 class="text-success">@Model.UserDistribution.Doctors.TotalCount</h4>
                                <p class="mb-0 text-muted">Doctors</p>
                                <small class="@(Model.UserDistribution.Doctors.ThisMonthCount > 0 ? "text-success" : "text-muted")">
                                    @if (Model.UserDistribution.Doctors.ThisMonthCount > 0)
                                    {
                                        <text>+@Model.UserDistribution.Doctors.ThisMonthCount new this month</text>
                                    }
                                    else
                                    {
                                        <text>No new doctors this month</text>
                                    }
                                </small>
                            </div>
                        </div>
                        
                        <!-- Admin Staff -->
                        <div class="col-6">
                            <div class="text-center p-3 border rounded-3 bg-light">
                                <div class="mb-2">
                                    <i class="ri-admin-line text-info" style="font-size: 2rem;"></i>
                                </div>
                                <h4 class="text-info">@Model.UserDistribution.AdminStaff.TotalCount</h4>
                                <p class="mb-0 text-muted">Admin Staff</p>
                                <small class="@(Model.UserDistribution.AdminStaff.PercentageChange == 0 ? "text-muted" : Model.UserDistribution.AdminStaff.PercentageChange > 0 ? "text-success" : "text-danger")">
                                    @if (Model.UserDistribution.AdminStaff.PercentageChange == 0)
                                    {
                                        <text>No change</text>
                                    }
                                    else
                                    {
                                        <text>@(Model.UserDistribution.AdminStaff.PercentageChange >= 0 ? "+" : "")@Model.UserDistribution.AdminStaff.PercentageChange.ToString("F1")% from last month</text>
                                    }
                                </small>
                            </div>
                        </div>
                        
                        <!-- Lab Staff -->
                        <div class="col-6">
                            <div class="text-center p-3 border rounded-3 bg-light">
                                <div class="mb-2">
                                    <i class="ri-test-tube-line text-warning" style="font-size: 2rem;"></i>
                                </div>
                                <h4 class="text-warning">@Model.UserDistribution.Labs.TotalCount</h4>
                                <p class="mb-0 text-muted">Lab Staff</p>
                                <small class="@(Model.UserDistribution.Labs.ThisMonthCount > 0 ? "text-success" : "text-muted")">
                                    @if (Model.UserDistribution.Labs.ThisMonthCount > 0)
                                    {
                                        <text>+@Model.UserDistribution.Labs.ThisMonthCount this month</text>
                                    }
                                    else
                                    {
                                        <text>No new lab staff this month</text>
                                    }
                                </small>
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    <div class="text-center text-muted py-4">
                        <i class="ri-loader-4-line ri-spin" style="font-size: 2rem;"></i>
                        <p class="mt-2">Loading user distribution data...</p>
                    </div>
                }
            </div>
        </div>
    </div>
    <div class="col-xl-6 col-lg-6 mb-3">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white border-bottom py-3">
                <h5 class="card-title mb-0 fw-semibold">
                    <i class="ri-bar-chart-line me-2 text-primary"></i>Monthly Statistics
                </h5>
            </div>
            <div class="card-body p-4">
                @if (Model.MonthlyStatistics != null)
                {
                    <div class="row g-3">
                        <div class="col-12">
                            <div class="d-flex justify-content-between align-items-center p-3 bg-light rounded-3">
                                <div>
                                    <h6 class="mb-1">New Registrations</h6>
                                    <small class="text-muted">This Month</small>
                                </div>
                                <div class="text-end">
                                    <h4 class="text-primary mb-0">@Model.MonthlyStatistics.NewRegistrationsThisMonth</h4>
                                    <small class="@(Model.MonthlyStatistics.RegistrationPercentageChange >= 0 ? "text-success" : "text-danger")">
                                        @(Model.MonthlyStatistics.RegistrationPercentageChange >= 0 ? "+" : "")@Model.MonthlyStatistics.RegistrationPercentageChange.ToString("F1")% 
                                        <i class="ri-arrow-@(Model.MonthlyStatistics.RegistrationPercentageChange >= 0 ? "up" : "down")-line"></i>
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="d-flex justify-content-between align-items-center p-3 bg-light rounded-3">
                                <div>
                                    <h6 class="mb-1">Total Appointments</h6>
                                    <small class="text-muted">This Month</small>
                                </div>
                                <div class="text-end">
                                    <h4 class="text-success mb-0">@Model.MonthlyStatistics.TotalAppointmentsThisMonth</h4>
                                    <small class="@(Model.MonthlyStatistics.AppointmentPercentageChange >= 0 ? "text-success" : "text-danger")">
                                        @(Model.MonthlyStatistics.AppointmentPercentageChange >= 0 ? "+" : "")@Model.MonthlyStatistics.AppointmentPercentageChange.ToString("F1")% 
                                        <i class="ri-arrow-@(Model.MonthlyStatistics.AppointmentPercentageChange >= 0 ? "up" : "down")-line"></i>
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="d-flex justify-content-between align-items-center p-3 bg-light rounded-3">
                                <div>
                                    <h6 class="mb-1">Lab Tests Completed</h6>
                                    <small class="text-muted">This Month</small>
                                </div>
                                <div class="text-end">
                                    <h4 class="text-info mb-0">@Model.MonthlyStatistics.LabTestsCompletedThisMonth</h4>
                                    <small class="@(Model.MonthlyStatistics.LabTestsPercentageChange >= 0 ? "text-success" : "text-danger")">
                                        @(Model.MonthlyStatistics.LabTestsPercentageChange >= 0 ? "+" : "")@Model.MonthlyStatistics.LabTestsPercentageChange.ToString("F1")% 
                                        <i class="ri-arrow-@(Model.MonthlyStatistics.LabTestsPercentageChange >= 0 ? "up" : "down")-line"></i>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    <div class="text-center text-muted py-4">
                        <i class="ri-loader-4-line ri-spin" style="font-size: 2rem;"></i>
                        <p class="mt-2">Loading monthly statistics...</p>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="row mb-4">
    <!-- Patient Registration Trends -->
    <div class="col-xl-7 col-lg-7 mb-3">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white border-bottom py-3">
                <h5 class="card-title mb-0 fw-semibold">
                    <i class="ri-line-chart-line me-2 text-primary"></i>Patient Registration Trends
                </h5>
            </div>
            <div class="card-body">
                <div class="chart-height">
                    <div id="patientTrends"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Appointment Status Overview -->
    <div class="col-xl-5 col-lg-5 mb-3">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white border-bottom py-3">
                <h5 class="card-title mb-0 fw-semibold">
                    <i class="ri-calendar-check-line me-2 text-primary"></i>Appointment Status
                </h5>
            </div>
            <div class="card-body">
                <div class="chart-height">
                    <div id="appointmentStatus"></div>
                </div>
            </div>
        </div>
    </div>
</div>

 
<!-- Main Content Row -->
<div class="row mb-4">
    <!-- Today's Appointments -->
    <div class="col-xl-6 col-lg-6 mb-3">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white border-bottom py-3">
                <div class="d-flex align-items-center justify-content-between">
                    <h5 class="card-title mb-0 fw-semibold">
                        <i class="ri-calendar-line me-2 text-primary"></i>
                        Today's Appointments
                    </h5>
                    <a href="/Appointments" class="btn btn-sm btn-primary px-3">View All</a>
                </div>
            </div>
            <div class="card-body">
                @if (Model.TodaysAppointmentsList != null && Model.TodaysAppointmentsList.Appointments.Any())
                {
                    <div class="list-group list-group-flush">
                        @foreach (var appointment in Model.TodaysAppointmentsList.Appointments.Take(5))
                        {
                            var statusText = appointment.Status.ToString();
                            var typeText = appointment.AppointmentType.ToString();

                            var statusBadgeClass = statusText switch
                            {
                                "Approved" => "bg-success",
                                "Pending" => "bg-warning",
                                "Created" => "bg-info",
                                "Rejected" => "bg-danger",
                                _ => "bg-secondary"
                            };
                            var avatarClass = statusText switch
                            {
                                "Approved" => "bg-success-subtle",
                                "Pending" => "bg-warning-subtle",
                                "Created" => "bg-info-subtle",
                                "Rejected" => "bg-danger-subtle",
                                _ => "bg-secondary-subtle"
                            };
                            var iconColor = statusText switch
                            {
                                "Approved" => "text-success",
                                "Pending" => "text-warning",
                                "Created" => "text-info",
                                "Rejected" => "text-danger",
                                _ => "text-secondary"
                            };

                            <div class="list-group-item border-0 px-0 py-3">
                                <div class="d-flex align-items-start">
                                    <div class="me-3">
                                        <div class="avatar-circle @avatarClass">
                                            <i class="ri-user-line @iconColor"></i>
                                        </div>
                                    </div>
                                    <div class="flex-grow-1">
                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                            <div>
                                                <h6 class="mb-1 fw-bold">@appointment.PatientName</h6>
                                                <small class="text-muted">ID: #@appointment.AppointmentID</small>
                                            </div>
                                            <span class="badge @statusBadgeClass">@appointment.Status</span>
                                        </div>
                                        <div class="appointment-details">
                                            <div class="d-flex flex-wrap gap-3 mb-2">
                                                <div class="detail-item">
                                                    <i class="ri-calendar-line text-primary me-1"></i>
                                                    <span class="fw-semibold">@appointment.AppointmentTime.ToString("h:mm tt")</span>
                                                </div>
                                                <div class="detail-item">
                                                    <i class="ri-stethoscope-line text-success me-1"></i>
                                                    <span>@appointment.DoctorName</span>
                                                </div>
                                            </div>
                                            <div class="appointment-type">
                                                <i class="ri-heart-pulse-line text-danger me-1"></i>
                                                <span class="text-muted">@typeText</span>
                                            </div>
                                            @if (!string.IsNullOrEmpty(appointment.Reason))
                                            {
                                                <small class="text-muted d-block mt-1">Reason: @appointment.Reason</small>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                    @if (Model.TodaysAppointmentsList.TotalToday > 5)
                    {
                        <div class="text-center mt-2">
                            <small class="text-muted">Showing 5 of @Model.TodaysAppointmentsList.TotalToday appointments</small>
                        </div>
                    }
                }
                else
                {
                    <div class="text-center py-4">
                        <i class="ri-calendar-line text-muted" style="font-size: 3rem;"></i>
                        <p class="text-muted mb-0">No appointments scheduled for today</p>
                        <a href="~/Admin/Appointments/Book" class="btn btn-sm btn-primary mt-2">
                            <i class="ri-add-line me-1"></i>Schedule Appointment
                        </a>
                    </div>
                }
            </div>
        </div>
    </div>
    
    <!-- Recent Lab Results -->
    <div class="col-xl-6 col-lg-6 mb-3">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white border-bottom py-3">
                <div class="d-flex align-items-center justify-content-between">
                    <h5 class="card-title mb-0 fw-semibold">
                        <i class="ri-test-tube-line me-2 text-primary"></i>
                        Recent Lab Results
                    </h5>
                    <a href="/Lab/Reports" class="btn btn-sm btn-primary px-3">View All</a>
                </div>
            </div>
            <div class="card-body">
                @if (Model.RecentLabResults != null && Model.RecentLabResults.Results.Any())
                {
                    <div class="list-group list-group-flush">
                        @foreach (var labResult in Model.RecentLabResults.Results.Take(5))
                        {
                            var statusBadgeClass = labResult.Status switch
                            {
                                "Completed" => "bg-success",
                                "Pending" => "bg-warning",
                                "InProgress" => "bg-info",
                                "Active" => "bg-primary",
                                _ => "bg-secondary"
                            };
                            var iconClass = labResult.IsUrgent ? "ri-alert-line text-danger" : "ri-test-tube-line text-info";

                            <div class="list-group-item d-flex align-items-center">
                                <div class="me-3">
                                    <i class="@iconClass" style="font-size: 1.5rem;"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">@labResult.TestName</h6>
                                    <p class="text-muted mb-1">@labResult.PatientName</p>
                                    <small class="text-muted">
                                        @if (labResult.CompletionDate.HasValue)
                                        {
                                            <text>Completed: @((DateTime.Now - labResult.CompletionDate.Value).TotalHours < 1 ? 
                                                "Less than an hour ago" : 
                                                $"{(int)(DateTime.Now - labResult.CompletionDate.Value).TotalHours} hours ago")</text>
                                        }
                                        else
                                        {
                                            <text>Requested: @labResult.RequestDate.ToString("MMM dd, h:mm tt")</text>
                                        }
                                    </small>
                                    @if (!string.IsNullOrEmpty(labResult.Notes))
                                    {
                                        <small class="text-muted d-block">@labResult.Notes</small>
                                    }
                                </div>
                                <span class="badge @statusBadgeClass">@labResult.Status</span>
                            </div>
                        }
                    </div>
                    @if (Model.RecentLabResults.TotalPendingResults > 0)
                    {
                        <div class="text-center mt-2">
                            <small class="text-warning">
                                <i class="ri-time-line"></i> @Model.RecentLabResults.TotalPendingResults pending results
                            </small>
                        </div>
                    }
                }
                else
                {
                    <div class="text-center py-4">
                        <i class="ri-test-tube-line text-muted" style="font-size: 3rem;"></i>
                        <p class="text-muted mb-0">No recent lab results</p>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        .chart-height {
            height: 300px;
        }
        
        .chart-height-sm {
            height: 250px;
        }
        
        .auto-align-graph {
            margin: 0 auto;
        }
        
        .apexcharts-canvas {
            margin: 0 auto;
        }
        
        /* Welcome Header */
        .welcome-header {
            padding: 1rem 0;
        }
        
        /* Modern Card Styles */
        .hover-card {
            transition: all 0.3s ease;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .hover-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.15) !important;
        }
        
        .icon-wrapper {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
        }
        
        /* Bootstrap subtle backgrounds */
        .bg-primary-subtle {
            background-color: rgba(13, 110, 253, 0.1) !important;
        }
        
        .bg-success-subtle {
            background-color: rgba(25, 135, 84, 0.1) !important;
        }
        
        .bg-warning-subtle {
            background-color: rgba(255, 193, 7, 0.1) !important;
        }
        
        .bg-info-subtle {
            background-color: rgba(13, 202, 240, 0.1) !important;
        }
        
        .bg-danger-subtle {
            background-color: rgba(220, 53, 69, 0.1) !important;
        }
        
        /* Badge subtle variants */
        .badge.bg-primary-subtle {
            color: #0d6efd !important;
        }
        
        .badge.bg-success-subtle {
            color: #198754 !important;
        }
        
        .badge.bg-warning-subtle {
            color: #ffc107 !important;
        }
        
        .badge.bg-info-subtle {
            color: #0dcaf0 !important;
        }
        
        .badge.bg-danger-subtle {
            color: #dc3545 !important;
        }
        
        /* Theme-based card styling */
        .icon-box {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .icon-box.md {
            width: 40px;
            height: 40px;
        }
        
        .bg-primary-lighten {
            background-color: rgba(13, 110, 253, 0.1) !important;
        }
        
        .bg-primary-light {
            background-color: rgba(13, 110, 253, 0.1) !important;
        }
        
        .card .card-body h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #333;
        }
        
        .card .card-body h2 {
            font-size: 2rem;
            color: #1a1a1a;
        }
        
        .badge.bg-primary-light {
            color: #0d6efd !important;
            background-color: rgba(13, 110, 253, 0.1) !important;
        }
        
        /* Quick Action Button Enhancements */
        .quick-action-btn {
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .quick-action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* Card Improvements */
        .card {
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1) !important;
        }
        
        /* Statistics Card Improvements */
        .card .card-body h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 0;
        }
        
        /* List Items */
        .list-group-item {
            border-left: none;
            border-right: none;
            padding: 1rem 0;
        }
        
        .list-group-item:first-child {
            border-top: none;
        }
        
        .list-group-item:last-child {
            border-bottom: none;
        }
        
        /* Badge Improvements */
        .badge {
            padding: 0.35em 0.85em;
            font-weight: 500;
            letter-spacing: 0.02em;
        }
        
        /* Rounded Improvements */
        .rounded-3 {
            border-radius: 0.5rem !important;
        }
        
        /* Avatar Circle for Appointments */
        .avatar-circle {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }
        
        /* Appointment Details Styling */
        .appointment-details {
            font-size: 0.875rem;
        }
        
        .detail-item {
            display: inline-flex;
            align-items: center;
        }
        
        .appointment-type {
            display: flex;
            align-items: center;
            padding: 0.375rem 0.75rem;
            background-color: #f8f9fa;
            border-radius: 6px;
            display: inline-flex;
        }
        
        /* Patient Info */
        .list-group-item h6 {
            font-size: 1rem;
            color: #1a1a1a;
        }
        
        /* Search Widget */
        .search-widget .input-group {
            border-radius: 10px;
            overflow: hidden;
        }
        
        .search-widget .form-control:focus {
            box-shadow: none;
            border-color: #dee2e6;
        }
        
        .search-widget .input-group-text {
            border: 1px solid #dee2e6;
        }
        
        /* Doctor Status Indicators */
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .status-available {
            background-color: #198754;
            box-shadow: 0 0 0 3px rgba(25, 135, 84, 0.2);
        }
        
        .status-busy {
            background-color: #ffc107;
            box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.2);
        }
        
        .status-offline {
            background-color: #6c757d;
            box-shadow: 0 0 0 3px rgba(108, 117, 125, 0.2);
        }
        
        .doctor-status-list h6 {
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }
        
        /* Performance Metrics */
        .metric-item .progress {
            border-radius: 10px;
        }
        
        .metric-item .progress-bar {
            border-radius: 10px;
        }
        
        /* Activity Timeline */
        .activity-timeline {
            position: relative;
        }
        
        .activity-item {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.25rem;
            position: relative;
        }
        
        .activity-item:last-child {
            margin-bottom: 0;
        }
        
        .activity-item:not(:last-child)::after {
            content: '';
            position: absolute;
            left: 16px;
            top: 36px;
            width: 2px;
            height: calc(100% + 0.5rem);
            background-color: #e9ecef;
        }
        
        .activity-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            position: relative;
            z-index: 1;
        }
        
        .activity-content p {
            font-size: 0.875rem;
            line-height: 1.4;
        }
        
        .activity-content strong {
            color: #1a1a1a;
        }
        
        /* Alert Enhancements */
        .alert {
            border-radius: 10px;
        }
        
        .alert-warning {
            background-color: #fff3cd;
        }
        
        /* Badge Secondary Subtle */
        .badge.bg-secondary-subtle {
            background-color: rgba(108, 117, 125, 0.1) !important;
            color: #6c757d !important;
        }
        
        /* System Stats */
        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }
        
        .system-stat-item h6 {
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
            color: #1a1a1a;
        }
        
        .system-stat-item p {
            font-size: 0.875rem;
        }
    </style>
}

@section Scripts {
    <!-- ApexCharts JS -->
    <script src="~/theme/vendor/apex/apexcharts.min.js"></script>
    
    <script>
        // Patient Registration Trends Chart
        @if (Model.PatientRegistrationTrends != null && Model.PatientRegistrationTrends.MonthlyData != null)
        {
            <text>
            var patientTrendsOptions = {
                chart: {
                    height: 300,
                    type: "line",
                    toolbar: {
                        show: false,
                    },
                },
                dataLabels: {
                    enabled: false,
                },
                fill: {
                    type: 'solid',
                    opacity: [0.1, 1],
                },
                stroke: {
                    curve: "smooth",
                    width: [5]
                },
                series: [{
                    name: 'New Patients',
                    type: 'area',
                    data: [@string.Join(", ", Model.PatientRegistrationTrends.MonthlyData.Select(m => m.Count))]
                }],
                grid: {
                    borderColor: "#d8dee6",
                    strokeDashArray: 5,
                    xaxis: {
                        lines: {
                            show: true,
                        },
                    },
                    yaxis: {
                        lines: {
                            show: false,
                        },
                    },
                    padding: {
                        top: 0,
                        right: 0,
                        bottom: 0,
                        left: 0,
                    },
                },
                xaxis: {
                    categories: [@Html.Raw(string.Join(", ", Model.PatientRegistrationTrends.MonthlyData.Select(m => $"\"{m.MonthName}\"")))],
                },
                yaxis: {
                    labels: {
                        show: true,
                    },
                },
                legend: {
                    position: 'top',
                    horizontalAlign: 'right',
                },
                colors: ["#0d6efd"],
                markers: {
                    size: 0,
                    opacity: 0.3,
                    colors: ["#0d6efd"],
                    strokeColor: "#ffffff",
                    strokeWidth: 1,
                    hover: {
                        size: 7,
                    },
                },
                tooltip: {
                    y: {
                        formatter: function (val) {
                            return val + " patients";
                        },
                    },
                },
                annotations: {
                    yaxis: [{
                        y: @Model.PatientRegistrationTrends.AveragePerMonth.ToString("F0"),
                        borderColor: '#198754',
                        label: {
                            borderColor: '#198754',
                            style: {
                                color: '#fff',
                                background: '#198754',
                            },
                            text: 'Average: @Model.PatientRegistrationTrends.AveragePerMonth.ToString("F0") per month',
                        }
                    }]
                }
            };

            var patientTrendsChart = new ApexCharts(document.querySelector("#patientTrends"), patientTrendsOptions);
            patientTrendsChart.render();
            </text>
        }

        // User Distribution Chart (Donut)
        @if (Model.UserDistributionStats != null)
        {
            <text>
            var departmentOptions = {
                chart: {
                    height: 300,
                    type: 'donut',
                },
                series: [@Model.UserDistributionStats.TotalPatients, @Model.UserDistributionStats.TotalDoctors, @Model.UserDistributionStats.TotalAdminStaff, @Model.UserDistributionStats.TotalLabStaff],
                labels: ['Patients', 'Doctors', 'Admin Staff', 'Lab Staff'],
                colors: ['#0d6efd', '#198754', '#ffc107', '#dc3545'],
                legend: {
                    position: 'bottom',
                    horizontalAlign: 'center',
                },
                plotOptions: {
                    pie: {
                        donut: {
                            size: '70%',
                            labels: {
                                show: true,
                                total: {
                                    show: true,
                                    label: 'Total Users',
                                    formatter: function () {
                                        return '@Model.UserDistributionStats.TotalUsers';
                                    }
                                }
                            }
                        }
                    }
                },
                dataLabels: {
                    enabled: true,
                    formatter: function (val) {
                        return Math.round(val) + "%"
                    }
                },
                tooltip: {
                    y: {
                        formatter: function (val) {
                            return val + " users"
                        }
                    }
                }
            };

            var departmentChart = new ApexCharts(document.querySelector("#departmentPerformance"), departmentOptions);
            departmentChart.render();
            </text>
        }

        // Appointment Status Chart (Bar)
        @if (Model.AppointmentStatusBreakdown != null)
        {
            <text>
            var appointmentStatusOptions = {
                chart: {
                    height: 300,
                    type: 'bar',
                    toolbar: {
                        show: false,
                    },
                },
                series: [{
                    name: 'Appointments',
                    data: [@Model.AppointmentStatusBreakdown.ApprovedCount, @Model.AppointmentStatusBreakdown.PendingCount, @Model.AppointmentStatusBreakdown.CompletedCount, @Model.AppointmentStatusBreakdown.CancelledCount, @Model.AppointmentStatusBreakdown.ScheduledCount]
                }],
                xaxis: {
                    categories: ['Approved', 'Pending', 'Completed', 'Cancelled', 'Scheduled'],
                },
                colors: ['#198754'],
                plotOptions: {
                    bar: {
                        horizontal: false,
                        columnWidth: '55%',
                        endingShape: 'rounded',
                        distributed: true,
                        colors: {
                            ranges: [{
                                from: 0,
                                to: 1000000,
                                color: '#198754'
                            }]
                        }
                    },
                },
                dataLabels: {
                    enabled: true,
                    formatter: function (val) {
                        return val;
                    }
                },
                grid: {
                    borderColor: "#d8dee6",
                    strokeDashArray: 5,
                },
                tooltip: {
                    y: {
                        formatter: function (val) {
                            return val + " appointments"
                        }
                    }
                }
            };

            var appointmentStatusChart = new ApexCharts(document.querySelector("#appointmentStatus"), appointmentStatusOptions);
            appointmentStatusChart.render();
            </text>
        }

        // Monthly Revenue Chart (Area) - Using appointment counts as proxy
        @if (Model.MonthlyStatistics != null)
        {
            <text>
            var revenueOptions = {
                chart: {
                    height: 300,
                    type: 'area',
                    toolbar: {
                        show: false,
                    },
                },
                series: [{
                    name: 'Revenue',
                    data: [@Model.MonthlyStatistics.RevenueThisMonth]
                }],
                xaxis: {
                    categories: ["@DateTime.Now.ToString("MMMM")"],
                },
                colors: ['#198754'],
                fill: {
                    type: 'gradient',
                    gradient: {
                        shadeIntensity: 1,
                        opacityFrom: 0.7,
                        opacityTo: 0.1,
                    }
                },
                stroke: {
                    curve: 'smooth',
                    width: 3
                },
                grid: {
                    borderColor: "#d8dee6",
                    strokeDashArray: 5,
                },
                dataLabels: {
                    enabled: false
                },
                tooltip: {
                    y: {
                        formatter: function (val) {
                            return "$" + val.toLocaleString()
                        }
                    }
                },
                annotations: {
                    texts: [{
                        x: '50%',
                        y: '50%',
                        text: 'Revenue: $@Model.MonthlyStatistics.RevenueThisMonth.ToString("N2")',
                        textAnchor: 'middle',
                        fontSize: '16px',
                        fontWeight: 600,
                        foreColor: '#198754'
                    }]
                }
            };

            var revenueChart = new ApexCharts(document.querySelector("#revenueTrends"), revenueOptions);
            revenueChart.render();
            </text>
        }
    </script>
}
