@page "/Admin/Reports/Appointments"
@model CareSync.Pages.Admin.AppointmentReportsModel
@{
    ViewData["Title"] = "Appointment Reports";
}

@section PageActions {
    <div class="d-flex gap-2">
        <button class="btn btn-outline-primary" onclick="exportReport('pdf')">
            <i class="ri-file-pdf-line me-2"></i>Export PDF
        </button>
        <button class="btn btn-outline-success" onclick="exportReport('excel')">
            <i class="ri-file-excel-line me-2"></i>Export Excel
        </button>
    </div>
}

<!-- Report Filters -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="ri-filter-line me-2"></i>Report Filters
                </h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">Date Range</label>
                        <input type="text" class="form-control" id="dateRange" placeholder="Select date range">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Doctor</label>
                        <select class="form-select">
                            <option value="">All Doctors</option>
                            <option value="dr-johnson">Dr. Johnson</option>
                            <option value="dr-chen">Dr. Chen</option>
                            <option value="dr-rodriguez">Dr. Rodriguez</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Department</label>
                        <select class="form-select">
                            <option value="">All Departments</option>
                            <option value="cardiology">Cardiology</option>
                            <option value="neurology">Neurology</option>
                            <option value="pediatrics">Pediatrics</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Status</label>
                        <select class="form-select">
                            <option value="">All Status</option>
                            <option value="scheduled">Scheduled</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                            <option value="no-show">No Show</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">&nbsp;</label>
                        <button class="btn btn-primary w-100">
                            <i class="ri-search-line me-2"></i>Generate Report
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Summary Cards -->
<div class="row mb-4">
    <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
        <div class="card border-primary">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="ri-calendar-line text-primary" style="font-size: 2rem;"></i>
                </div>
                <h3 class="card-title text-primary">1,456</h3>
                <p class="card-text text-muted">Total Appointments</p>
                <small class="text-success">+8.2% from last month</small>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
        <div class="card border-success">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="ri-calendar-check-line text-success" style="font-size: 2rem;"></i>
                </div>
                <h3 class="card-title text-success">1,234</h3>
                <p class="card-text text-muted">Completed</p>
                <small class="text-success">84.7% completion rate</small>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
        <div class="card border-warning">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="ri-calendar-close-line text-warning" style="font-size: 2rem;"></i>
                </div>
                <h3 class="card-title text-warning">156</h3>
                <p class="card-text text-muted">Cancelled</p>
                <small class="text-warning">10.7% cancellation rate</small>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
        <div class="card border-danger">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="ri-user-unfollow-line text-danger" style="font-size: 2rem;"></i>
                </div>
                <h3 class="card-title text-danger">66</h3>
                <p class="card-text text-muted">No Shows</p>
                <small class="text-danger">4.5% no-show rate</small>
            </div>
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="row mb-4">
    <div class="col-xl-8 col-lg-7">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="ri-line-chart-line me-2"></i>Appointment Trends
                </h5>
            </div>
            <div class="card-body">
                <div class="chart-container" style="height: 300px;">
                    <canvas id="appointmentTrendsChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-4 col-lg-5">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="ri-donut-chart-line me-2"></i>Status Distribution
                </h5>
            </div>
            <div class="card-body">
                <div class="chart-container" style="height: 300px;">
                    <canvas id="statusDistributionChart"></canvas>
                </div>
                <div class="mt-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="d-flex align-items-center">
                            <span class="badge bg-success me-2">&nbsp;</span>Completed
                        </span>
                        <span class="fw-bold">1,234 (84.7%)</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="d-flex align-items-center">
                            <span class="badge bg-warning me-2">&nbsp;</span>Cancelled
                        </span>
                        <span class="fw-bold">156 (10.7%)</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="d-flex align-items-center">
                            <span class="badge bg-danger me-2">&nbsp;</span>No Shows
                        </span>
                        <span class="fw-bold">66 (4.5%)</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Department Performance -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="ri-building-2-line me-2"></i>Department Performance
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Department</th>
                                <th>Total Appointments</th>
                                <th>Completed</th>
                                <th>Cancelled</th>
                                <th>No Shows</th>
                                <th>Completion Rate</th>
                                <th>Average Duration</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="icon-box sm bg-primary-subtle rounded me-2">
                                            <i class="ri-heart-pulse-line text-primary"></i>
                                        </div>
                                        <span class="fw-semibold">Cardiology</span>
                                    </div>
                                </td>
                                <td>456</td>
                                <td><span class="text-success fw-bold">398</span></td>
                                <td><span class="text-warning">42</span></td>
                                <td><span class="text-danger">16</span></td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="progress me-2" style="width: 100px; height: 8px;">
                                            <div class="progress-bar bg-success" style="width: 87%"></div>
                                        </div>
                                        <span class="text-success fw-bold">87.3%</span>
                                    </div>
                                </td>
                                <td>45 min</td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="icon-box sm bg-success-subtle rounded me-2">
                                            <i class="ri-brain-line text-success"></i>
                                        </div>
                                        <span class="fw-semibold">Neurology</span>
                                    </div>
                                </td>
                                <td>324</td>
                                <td><span class="text-success fw-bold">278</span></td>
                                <td><span class="text-warning">32</span></td>
                                <td><span class="text-danger">14</span></td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="progress me-2" style="width: 100px; height: 8px;">
                                            <div class="progress-bar bg-success" style="width: 86%"></div>
                                        </div>
                                        <span class="text-success fw-bold">85.8%</span>
                                    </div>
                                </td>
                                <td>60 min</td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="icon-box sm bg-info-subtle rounded me-2">
                                            <i class="ri-parent-line text-info"></i>
                                        </div>
                                        <span class="fw-semibold">Pediatrics</span>
                                    </div>
                                </td>
                                <td>298</td>
                                <td><span class="text-success fw-bold">256</span></td>
                                <td><span class="text-warning">28</span></td>
                                <td><span class="text-danger">14</span></td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="progress me-2" style="width: 100px; height: 8px;">
                                            <div class="progress-bar bg-success" style="width: 86%"></div>
                                        </div>
                                        <span class="text-success fw-bold">85.9%</span>
                                    </div>
                                </td>
                                <td>30 min</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Detailed Appointment Report -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <div class="d-flex align-items-center justify-content-between">
                    <h5 class="card-title mb-0">
                        <i class="ri-table-line me-2"></i>Detailed Appointment Report
                    </h5>
                    <div class="d-flex gap-2">
                        <input type="text" class="form-control form-control-sm" placeholder="Search appointments..." style="width: 200px;">
                        <button class="btn btn-sm btn-outline-primary">
                            <i class="ri-search-line"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Appointment ID</th>
                                <th>Patient</th>
                                <th>Doctor</th>
                                <th>Department</th>
                                <th>Date & Time</th>
                                <th>Duration</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge bg-light text-dark">APT001</span></td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <img src="~/theme/images/users/1.jpg" class="img-2x rounded-circle me-2" alt="Patient">
                                        <div>
                                            <h6 class="mb-0">John Smith</h6>
                                            <small class="text-muted">ID: PAT001</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div>
                                        <h6 class="mb-0">Dr. Sarah Johnson</h6>
                                        <small class="text-muted">Cardiologist</small>
                                    </div>
                                </td>
                                <td><span class="badge bg-primary-subtle text-primary">Cardiology</span></td>
                                <td>
                                    <div>
                                        <span class="fw-semibold">Nov 15, 2024</span><br>
                                        <small class="text-muted">10:00 AM</small>
                                    </div>
                                </td>
                                <td>45 min</td>
                                <td><span class="badge bg-success">Completed</span></td>
                                <td>
                                    <div class="d-flex gap-1">
                                        <button class="btn btn-sm btn-outline-primary" data-bs-toggle="tooltip" title="View Details">
                                            <i class="ri-eye-line"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-info" data-bs-toggle="tooltip" title="Reschedule">
                                            <i class="ri-calendar-line"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-light text-dark">APT002</span></td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <img src="~/theme/images/users/2.jpg" class="img-2x rounded-circle me-2" alt="Patient">
                                        <div>
                                            <h6 class="mb-0">Emma Wilson</h6>
                                            <small class="text-muted">ID: PAT002</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div>
                                        <h6 class="mb-0">Dr. Michael Chen</h6>
                                        <small class="text-muted">Neurologist</small>
                                    </div>
                                </td>
                                <td><span class="badge bg-success-subtle text-success">Neurology</span></td>
                                <td>
                                    <div>
                                        <span class="fw-semibold">Nov 15, 2024</span><br>
                                        <small class="text-muted">2:30 PM</small>
                                    </div>
                                </td>
                                <td>60 min</td>
                                <td><span class="badge bg-warning">Cancelled</span></td>
                                <td>
                                    <div class="d-flex gap-1">
                                        <button class="btn btn-sm btn-outline-primary" data-bs-toggle="tooltip" title="View Details">
                                            <i class="ri-eye-line"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-info" data-bs-toggle="tooltip" title="Reschedule">
                                            <i class="ri-calendar-line"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                <nav aria-label="Page navigation" class="mt-4">
                    <ul class="pagination justify-content-center">
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1">Previous</a>
                        </li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item">
                            <a class="page-link" href="#">Next</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function exportReport(format) {
            alert(`Exporting appointment report in ${format.toUpperCase()} format...`);
            // Implementation for export functionality
        }

        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });

        // Sample chart initialization
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Appointment Reports page loaded - Charts can be initialized here');
        });
    </script>
}
