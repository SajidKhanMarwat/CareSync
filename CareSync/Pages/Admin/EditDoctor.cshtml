@page
@model CareSync.Pages.Admin.EditDoctorModel
@{
    ViewData["Title"] = "Edit Doctor";
    Layout = "~/Pages/Shared/Layouts/_MainLayout.cshtml";
}

<div class="container-fluid">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h4 class="mb-1">Edit Doctor</h4>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb mb-0">
                            <li class="breadcrumb-item"><a href="/Admin/Dashboard">Dashboard</a></li>
                            <li class="breadcrumb-item"><a href="/Admin/Doctors">Doctors</a></li>
                            <li class="breadcrumb-item active">Edit</li>
                        </ol>
                    </nav>
                </div>
                <div>
                    <a href="/Admin/DoctorProfile?id=@Model.Id" class="btn btn-secondary">
                        <i class="ri-arrow-left-line me-2"></i>Cancel
                    </a>
                </div>
            </div>
        </div>
    </div>

    @if (Model.Doctor != null)
    {
        <form method="post">
            <input type="hidden" asp-for="Id" />
            
            <div class="row">
                <div class="col-xl-8">
                    <!-- Personal Information -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0">Personal Information</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label asp-for="Doctor.FirstName" class="form-label">First Name <span class="text-danger">*</span></label>
                                    <input asp-for="Doctor.FirstName" class="form-control" required />
                                    <span asp-validation-for="Doctor.FirstName" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label asp-for="Doctor.LastName" class="form-label">Last Name <span class="text-danger">*</span></label>
                                    <input asp-for="Doctor.LastName" class="form-control" required />
                                    <span asp-validation-for="Doctor.LastName" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label asp-for="Doctor.Email" class="form-label">Email <span class="text-danger">*</span></label>
                                    <input asp-for="Doctor.Email" type="email" class="form-control" required />
                                    <span asp-validation-for="Doctor.Email" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label asp-for="Doctor.PhoneNumber" class="form-label">Phone Number</label>
                                    <input asp-for="Doctor.PhoneNumber" type="tel" class="form-control" />
                                    <span asp-validation-for="Doctor.PhoneNumber" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label asp-for="Doctor.DateOfBirth" class="form-label">Date of Birth</label>
                                    <input asp-for="Doctor.DateOfBirth" type="date" class="form-control" />
                                    <span asp-validation-for="Doctor.DateOfBirth" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label asp-for="Doctor.Address" class="form-label">Address</label>
                                    <input asp-for="Doctor.Address" class="form-control" />
                                    <span asp-validation-for="Doctor.Address" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Professional Information -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0">Professional Information</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label asp-for="Doctor.Specialization" class="form-label">Specialization</label>
                                    <select asp-for="Doctor.Specialization" class="form-select">
                                        <option value="">Select Specialization</option>
                                        <option value="Cardiology">Cardiology</option>
                                        <option value="Neurology">Neurology</option>
                                        <option value="Orthopedics">Orthopedics</option>
                                        <option value="Pediatrics">Pediatrics</option>
                                        <option value="Emergency">Emergency</option>
                                        <option value="General">General Practice</option>
                                        <option value="Dermatology">Dermatology</option>
                                        <option value="Psychiatry">Psychiatry</option>
                                        <option value="Radiology">Radiology</option>
                                        <option value="Surgery">Surgery</option>
                                    </select>
                                    <span asp-validation-for="Doctor.Specialization" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label asp-for="Doctor.LicenseNumber" class="form-label">License Number</label>
                                    <input asp-for="Doctor.LicenseNumber" class="form-control" />
                                    <span asp-validation-for="Doctor.LicenseNumber" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label asp-for="Doctor.ExperienceYears" class="form-label">Years of Experience</label>
                                    <input asp-for="Doctor.ExperienceYears" type="number" min="0" class="form-control" />
                                    <span asp-validation-for="Doctor.ExperienceYears" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label asp-for="Doctor.HospitalAffiliation" class="form-label">Hospital Affiliation</label>
                                    <input asp-for="Doctor.HospitalAffiliation" class="form-control" />
                                    <span asp-validation-for="Doctor.HospitalAffiliation" class="text-danger"></span>
                                </div>
                                <div class="col-12 mb-3">
                                    <label asp-for="Doctor.Qualifications" class="form-label">Qualifications</label>
                                    <textarea asp-for="Doctor.Qualifications" class="form-control" rows="3"></textarea>
                                    <span asp-validation-for="Doctor.Qualifications" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Schedule Information -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0">Schedule Information</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-12 mb-3">
                                    <label class="form-label">Available Days</label>
                                    <div class="d-flex flex-wrap gap-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="Monday" id="monday" name="AvailableDays">
                                            <label class="form-check-label" for="monday">Monday</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="Tuesday" id="tuesday" name="AvailableDays">
                                            <label class="form-check-label" for="tuesday">Tuesday</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="Wednesday" id="wednesday" name="AvailableDays">
                                            <label class="form-check-label" for="wednesday">Wednesday</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="Thursday" id="thursday" name="AvailableDays">
                                            <label class="form-check-label" for="thursday">Thursday</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="Friday" id="friday" name="AvailableDays">
                                            <label class="form-check-label" for="friday">Friday</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="Saturday" id="saturday" name="AvailableDays">
                                            <label class="form-check-label" for="saturday">Saturday</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="Sunday" id="sunday" name="AvailableDays">
                                            <label class="form-check-label" for="sunday">Sunday</label>
                                        </div>
                                    </div>
                                    <input type="hidden" asp-for="Doctor.AvailableDays" id="availableDaysHidden" />
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label asp-for="Doctor.StartTime" class="form-label">Start Time</label>
                                    <input asp-for="Doctor.StartTime" type="time" class="form-control" />
                                    <span asp-validation-for="Doctor.StartTime" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label asp-for="Doctor.EndTime" class="form-label">End Time</label>
                                    <input asp-for="Doctor.EndTime" type="time" class="form-control" />
                                    <span asp-validation-for="Doctor.EndTime" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-4">
                    <!-- Profile Image -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0">Profile Image</h6>
                        </div>
                        <div class="card-body text-center">
                            <img src="@(Model.ProfileImage ?? "/theme/images/default-doctor.png")" 
                                 alt="Profile" 
                                 class="rounded-circle mb-3" 
                                 style="width: 150px; height: 150px; object-fit: cover;">
                            <p class="text-muted small">Profile image can be updated from user settings</p>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="card">
                        <div class="card-body">
                            <button type="submit" class="btn btn-primary w-100 mb-2">
                                <i class="ri-save-line me-2"></i>Save Changes
                            </button>
                            <a href="/Admin/DoctorProfile?id=@Model.Id" class="btn btn-outline-secondary w-100">
                                <i class="ri-close-line me-2"></i>Cancel
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    }
    else
    {
        <div class="alert alert-warning">
            <i class="ri-alert-line me-2"></i>Doctor not found.
        </div>
    }
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Handle available days checkboxes
        document.addEventListener('DOMContentLoaded', function() {
            const checkboxes = document.querySelectorAll('input[name="AvailableDays"]');
            const hiddenInput = document.getElementById('availableDaysHidden');
            
            // Set initial state from hidden input
            if (hiddenInput.value) {
                const days = hiddenInput.value.split(',');
                checkboxes.forEach(cb => {
                    if (days.includes(cb.value)) {
                        cb.checked = true;
                    }
                });
            }
            
            // Update hidden input when checkboxes change
            checkboxes.forEach(cb => {
                cb.addEventListener('change', function() {
                    const selectedDays = Array.from(checkboxes)
                        .filter(cb => cb.checked)
                        .map(cb => cb.value);
                    hiddenInput.value = selectedDays.join(',');
                });
            });
        });
    </script>
}
