@page "/Lab/RequestDetails/{id?}"
@model CareSync.Pages.Lab.RequestDetailsModel
@{
    ViewData["Title"] = "Request Details";
    var requestId = RouteData.Values["id"]?.ToString() ?? "LR001";
}

@section PageActions {
    <div class="d-flex gap-2">
        <a href="~/Lab/Requests" class="btn btn-outline-secondary">
            <i class="ri-arrow-left-line me-1"></i>Back to Requests
        </a>
        <button type="button" class="btn btn-success">
            <i class="ri-check-line me-1"></i>Accept Request
        </button>
        <button type="button" class="btn btn-primary">
            <i class="ri-edit-line me-1"></i>Update Status
        </button>
        <button type="button" class="btn btn-outline-info">
            <i class="ri-printer-line me-1"></i>Print
        </button>
    </div>
}

<!-- Request Status -->
<div class="row gx-3 mb-3">
    <div class="col-12">
        <div class="card border-primary">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <div class="d-flex align-items-center">
                            <div class="icon-box xl bg-primary-subtle rounded-circle me-3">
                                <i class="ri-file-list-3-line text-primary fs-3"></i>
                            </div>
                            <div>
                                <h4 class="mb-1">Lab Request #@requestId</h4>
                                <p class="text-muted mb-0">
                                    <i class="ri-calendar-line me-1"></i>Requested on: November 16, 2024 at 10:30 AM
                                    <span class="mx-2">|</span>
                                    <i class="ri-user-line me-1"></i>Requested by: Dr. Sarah Johnson
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 text-md-end mt-3 mt-md-0">
                        <span class="badge bg-warning fs-6 mb-2">Pending</span>
                        <br>
                        <span class="badge bg-danger fs-6">Urgent Priority</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="row gx-3">
    <div class="col-xl-8">
        <!-- Patient Information -->
        <div class="card mb-3">
            <div class="card-header bg-primary-subtle">
                <h5 class="card-title mb-0">
                    <i class="ri-user-heart-line me-2"></i>Patient Information
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <table class="table table-borderless mb-0">
                            <tr>
                                <td class="text-muted" style="width: 40%;">Patient Name:</td>
                                <td><strong>John Michael Smith</strong></td>
                            </tr>
                            <tr>
                                <td class="text-muted">Patient ID:</td>
                                <td><strong>P-2024-1156</strong></td>
                            </tr>
                            <tr>
                                <td class="text-muted">Age / Gender:</td>
                                <td>45 Years / Male</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Date of Birth:</td>
                                <td>March 15, 1979</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <table class="table table-borderless mb-0">
                            <tr>
                                <td class="text-muted" style="width: 40%;">Contact Number:</td>
                                <td>+1 (555) 123-4567</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Email:</td>
                                <td>john.smith@email.com</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Blood Group:</td>
                                <td><span class="badge bg-danger-subtle text-danger">A+</span></td>
                            </tr>
                            <tr>
                                <td class="text-muted">Address:</td>
                                <td>123 Main St, New York, NY 10001</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Details -->
        <div class="card mb-3">
            <div class="card-header bg-success-subtle">
                <h5 class="card-title mb-0">
                    <i class="ri-test-tube-line me-2"></i>Test Details
                </h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="text-muted mb-1">Test/Service Name</label>
                        <h6>Complete Blood Count (CBC)</h6>
                    </div>
                    <div class="col-md-6">
                        <label class="text-muted mb-1">Test Category</label>
                        <h6><span class="badge bg-primary">Hematology</span></h6>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="text-muted mb-1">Sample Type</label>
                        <h6><span class="badge bg-danger-subtle text-danger">Blood (EDTA)</span></h6>
                    </div>
                    <div class="col-md-6">
                        <label class="text-muted mb-1">Sample Volume Required</label>
                        <h6>5 mL</h6>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="text-muted mb-1">Estimated Time</label>
                        <h6>2-4 hours</h6>
                    </div>
                    <div class="col-md-6">
                        <label class="text-muted mb-1">Service Fee</label>
                        <h6 class="text-success">$45.00</h6>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <label class="text-muted mb-1">Clinical Notes / Indication</label>
                        <div class="alert alert-info mb-0">
                            <i class="ri-information-line me-2"></i>
                            Patient presenting with fatigue and weakness. CBC requested to rule out anemia or infection.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sample Information -->
        <div class="card mb-3">
            <div class="card-header bg-warning-subtle">
                <h5 class="card-title mb-0">
                    <i class="ri-flask-line me-2"></i>Sample Information
                </h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="text-muted mb-1">Sample Collection Date/Time</label>
                        <h6>November 16, 2024 at 09:45 AM</h6>
                    </div>
                    <div class="col-md-6">
                        <label class="text-muted mb-1">Collection Location</label>
                        <h6>Lab Collection Room 1</h6>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="text-muted mb-1">Collected By</label>
                        <h6>Tech. Alice Johnson</h6>
                    </div>
                    <div class="col-md-6">
                        <label class="text-muted mb-1">Sample Condition</label>
                        <h6><span class="badge bg-success">Good</span></h6>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <label class="text-muted mb-1">Special Handling Instructions</label>
                        <p class="mb-0">Keep refrigerated at 2-8Â°C. Process within 4 hours of collection.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Request History -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="ri-history-line me-2"></i>Request History
                </h5>
            </div>
            <div class="card-body">
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-marker bg-primary"></div>
                        <div class="timeline-content">
                            <div class="d-flex justify-content-between align-items-start mb-1">
                                <h6 class="mb-0">Request Created</h6>
                                <small class="text-muted">Nov 16, 2024 - 10:30 AM</small>
                            </div>
                            <p class="text-muted mb-0">Request created by Dr. Sarah Johnson</p>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-marker bg-info"></div>
                        <div class="timeline-content">
                            <div class="d-flex justify-content-between align-items-start mb-1">
                                <h6 class="mb-0">Sample Collected</h6>
                                <small class="text-muted">Nov 16, 2024 - 09:45 AM</small>
                            </div>
                            <p class="text-muted mb-0">Sample collected by Tech. Alice Johnson</p>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-marker bg-warning"></div>
                        <div class="timeline-content">
                            <div class="d-flex justify-content-between align-items-start mb-1">
                                <h6 class="mb-0">Awaiting Processing</h6>
                                <small class="text-muted">Current Status</small>
                            </div>
                            <p class="text-muted mb-0">Waiting for lab technician assignment</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-4">
        <!-- Quick Actions -->
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="ri-dashboard-line me-2"></i>Quick Actions
                </h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <button class="btn btn-success">
                        <i class="ri-check-line me-2"></i>Accept & Start Processing
                    </button>
                    <a href="~/Lab/ResultEntry?requestId=@requestId" class="btn btn-primary">
                        <i class="ri-edit-line me-2"></i>Enter Results
                    </a>
                    <button class="btn btn-outline-warning">
                        <i class="ri-pause-line me-2"></i>Put on Hold
                    </button>
                    <button class="btn btn-outline-danger">
                        <i class="ri-close-line me-2"></i>Reject Request
                    </button>
                    <hr>
                    <a href="~/Lab/Reports?requestId=@requestId" class="btn btn-outline-info">
                        <i class="ri-file-chart-line me-2"></i>Generate Report
                    </a>
                    <button class="btn btn-outline-secondary">
                        <i class="ri-printer-line me-2"></i>Print Request
                    </button>
                </div>
            </div>
        </div>

        <!-- Doctor Information -->
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="ri-stethoscope-line me-2"></i>Requesting Doctor
                </h5>
            </div>
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <img src="~/theme/images/doctor6.png" class="img-3x rounded-circle me-3" alt="Doctor">
                    <div>
                        <h6 class="mb-0">Dr. Sarah Johnson</h6>
                        <small class="text-muted">Cardiologist</small>
                    </div>
                </div>
                <table class="table table-borderless table-sm mb-0">
                    <tr>
                        <td class="text-muted">Department:</td>
                        <td>Cardiology</td>
                    </tr>
                    <tr>
                        <td class="text-muted">Contact:</td>
                        <td>+1 (555) 987-6543</td>
                    </tr>
                    <tr>
                        <td class="text-muted">Email:</td>
                        <td>s.johnson@hospital.com</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Priority & Timeline -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="ri-time-line me-2"></i>Priority & Timeline
                </h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="text-muted mb-1">Priority Level</label>
                    <h6><span class="badge bg-danger fs-6">Urgent</span></h6>
                </div>
                <div class="mb-3">
                    <label class="text-muted mb-1">Expected Completion</label>
                    <h6>November 16, 2024 - 02:30 PM</h6>
                </div>
                <div class="mb-3">
                    <label class="text-muted mb-1">Time Remaining</label>
                    <div class="progress" style="height: 25px;">
                        <div class="progress-bar bg-warning" style="width: 45%">
                            <strong>2 hrs 15 min</strong>
                        </div>
                    </div>
                </div>
                <div class="alert alert-warning mb-0">
                    <i class="ri-alarm-warning-line me-2"></i>
                    <strong>Urgent Priority:</strong> Please process this request as soon as possible.
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        .timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .timeline-item {
            position: relative;
            padding-bottom: 20px;
        }
        
        .timeline-item:not(:last-child)::before {
            content: '';
            position: absolute;
            left: -21px;
            top: 20px;
            bottom: -20px;
            width: 2px;
            background: #e0e0e0;
        }
        
        .timeline-marker {
            position: absolute;
            left: -26px;
            top: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 0 0 2px currentColor;
        }
        
        .timeline-content {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
        }
    </style>
}

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Action button handlers would go here
            console.log('Request Details page loaded for request: @requestId');
        });
    </script>
}
