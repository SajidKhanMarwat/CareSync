@page "/Lab/Dashboard"
@model CareSync.Pages.Lab.DashboardModel
@{
    ViewData["Title"] = "Lab Dashboard";
}

@section PageActions {
    <div class="d-flex gap-2">
        <a href="~/Lab/ResultEntry" class="btn btn-success">
            <i class="ri-add-line me-1"></i>New Test Entry
        </a>
        <a href="~/Lab/TestRequests" class="btn btn-primary">
            <i class="ri-file-list-line me-1"></i>View All Requests
        </a>
        <a href="~/Lab/AddService" class="btn btn-outline-success">
            <i class="ri-service-line me-1"></i>Add Service
        </a>
        <a href="~/Lab/Reports" class="btn btn-outline-info">
            <i class="ri-file-chart-line me-1"></i>View Reports
        </a>
    </div>
}

<!-- Lab Statistics Cards -->
<div class="row gx-3 mb-3">
    <div class="col-xl-3 col-sm-6">
        <div class="card border rounded-5">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="icon-box lg bg-warning-subtle rounded-5 me-3">
                        <i class="ri-time-line fs-4 text-warning"></i>
                    </div>
                    <div>
                        <h4 class="text-warning mb-1">24</h4>
                        <small class="text-muted">Pending Tests</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-sm-6">
        <div class="card border rounded-5">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="icon-box lg bg-info-subtle rounded-5 me-3">
                        <i class="ri-flask-line fs-4 text-info"></i>
                    </div>
                    <div>
                        <h4 class="text-info mb-1">18</h4>
                        <small class="text-muted">In Progress</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-sm-6">
        <div class="card border rounded-5">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="icon-box lg bg-success-subtle rounded-5 me-3">
                        <i class="ri-check-double-line fs-4 text-success"></i>
                    </div>
                    <div>
                        <h4 class="text-success mb-1">156</h4>
                        <small class="text-muted">Completed Today</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-sm-6">
        <div class="card border rounded-5">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="icon-box lg bg-danger-subtle rounded-5 me-3">
                        <i class="ri-alert-line fs-4 text-danger"></i>
                    </div>
                    <div>
                        <h4 class="text-danger mb-1">3</h4>
                        <small class="text-muted">Critical Results</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Lab Requests Overview -->
<div class="row gx-3 mb-3">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-primary-subtle">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="ri-inbox-line me-2"></i>Recent Lab Requests
                    </h5>
                    <a href="~/Lab/Requests" class="btn btn-sm btn-primary">
                        <i class="ri-list-check me-1"></i>View All Requests
                    </a>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Request ID</th>
                                <th>Patient</th>
                                <th>Service</th>
                                <th>Status</th>
                                <th>Priority</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>#LR001</strong></td>
                                <td>
                                    <div>
                                        <h6 class="mb-0">John Smith</h6>
                                        <small class="text-muted">P-2024-1156</small>
                                    </div>
                                </td>
                                <td>Complete Blood Count</td>
                                <td><span class="badge bg-warning">Pending</span></td>
                                <td><span class="badge bg-danger">Urgent</span></td>
                                <td>
                                    <a href="~/Lab/RequestDetails/LR001" class="btn btn-sm btn-outline-primary">
                                        <i class="ri-eye-line"></i> View
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>#LR002</strong></td>
                                <td>
                                    <div>
                                        <h6 class="mb-0">Mary Johnson</h6>
                                        <small class="text-muted">P-2024-1157</small>
                                    </div>
                                </td>
                                <td>Lipid Profile</td>
                                <td><span class="badge bg-info">In Progress</span></td>
                                <td><span class="badge bg-info">Normal</span></td>
                                <td>
                                    <a href="~/Lab/RequestDetails/LR002" class="btn btn-sm btn-outline-primary">
                                        <i class="ri-eye-line"></i> View
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>#LR003</strong></td>
                                <td>
                                    <div>
                                        <h6 class="mb-0">Robert Davis</h6>
                                        <small class="text-muted">P-2024-1158</small>
                                    </div>
                                </td>
                                <td>Thyroid Function Test</td>
                                <td><span class="badge bg-success">Completed</span></td>
                                <td><span class="badge bg-info">Normal</span></td>
                                <td>
                                    <a href="~/Lab/RequestDetails/LR003" class="btn btn-sm btn-outline-success">
                                        <i class="ri-file-chart-line"></i> Report
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Lab Services Overview -->
<div class="row gx-3 mb-3">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-success-subtle">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="ri-service-line me-2"></i>Available Lab Services
                    </h5>
                    <div class="d-flex gap-2">
                        <a href="~/Lab/AddService" class="btn btn-sm btn-success">
                            <i class="ri-add-line me-1"></i>Add New Service
                        </a>
                        <a href="~/Lab/ManageServices" class="btn btn-sm btn-outline-primary">
                            <i class="ri-settings-3-line me-1"></i>Manage Services
                        </a>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <div class="service-card border rounded-4 p-3 h-100">
                            <div class="d-flex align-items-center mb-2">
                                <div class="icon-box md bg-primary-subtle rounded-circle me-3">
                                    <i class="ri-drop-line text-primary"></i>
                                </div>
                                <div>
                                    <h6 class="mb-0">Hematology</h6>
                                    <small class="text-muted">12 Tests</small>
                                </div>
                            </div>
                            <p class="text-muted small mb-2">Blood count, coagulation, blood typing</p>
                            <a href="~/Lab/Services?category=Hematology" class="btn btn-sm btn-outline-primary w-100">
                                <i class="ri-eye-line me-1"></i>View Tests
                            </a>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="service-card border rounded-4 p-3 h-100">
                            <div class="d-flex align-items-center mb-2">
                                <div class="icon-box md bg-success-subtle rounded-circle me-3">
                                    <i class="ri-flask-line text-success"></i>
                                </div>
                                <div>
                                    <h6 class="mb-0">Clinical Chemistry</h6>
                                    <small class="text-muted">24 Tests</small>
                                </div>
                            </div>
                            <p class="text-muted small mb-2">Metabolic panels, enzymes, electrolytes</p>
                            <a href="~/Lab/Services?category=Chemistry" class="btn btn-sm btn-outline-success w-100">
                                <i class="ri-eye-line me-1"></i>View Tests
                            </a>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="service-card border rounded-4 p-3 h-100">
                            <div class="d-flex align-items-center mb-2">
                                <div class="icon-box md bg-warning-subtle rounded-circle me-3">
                                    <i class="ri-microscope-line text-warning"></i>
                                </div>
                                <div>
                                    <h6 class="mb-0">Microbiology</h6>
                                    <small class="text-muted">8 Tests</small>
                                </div>
                            </div>
                            <p class="text-muted small mb-2">Culture, sensitivity, microscopy</p>
                            <a href="~/Lab/Services?category=Microbiology" class="btn btn-sm btn-outline-warning w-100">
                                <i class="ri-eye-line me-1"></i>View Tests
                            </a>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="service-card border rounded-4 p-3 h-100">
                            <div class="d-flex align-items-center mb-2">
                                <div class="icon-box md bg-info-subtle rounded-circle me-3">
                                    <i class="ri-virus-line text-info"></i>
                                </div>
                                <div>
                                    <h6 class="mb-0">Immunology</h6>
                                    <small class="text-muted">15 Tests</small>
                                </div>
                            </div>
                            <p class="text-muted small mb-2">Serology, autoimmune markers</p>
                            <a href="~/Lab/Services?category=Immunology" class="btn btn-sm btn-outline-info w-100">
                                <i class="ri-eye-line me-1"></i>View Tests
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="row gx-3">
    <div class="col-xl-8">
        <!-- Priority Tests -->
        <div class="card mb-3">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="ri-alarm-warning-line me-2"></i>Priority Tests
                    </h5>
                    <span class="badge bg-danger-subtle text-danger">Urgent</span>
                </div>
            </div>
            <div class="card-body">
                <!-- Priority Test 1 -->
                <div class="test-item border border-danger rounded-4 p-3 mb-3">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <div class="d-flex align-items-start">
                                <div class="icon-box md bg-danger-subtle rounded-circle me-3">
                                    <i class="ri-heart-pulse-line text-danger"></i>
                                </div>
                                <div>
                                    <h6 class="mb-1">Cardiac Enzymes - STAT</h6>
                                    <p class="text-muted mb-1">Patient: John Smith (ID: P-2024-1156)</p>
                                    <small class="text-muted">
                                        <i class="ri-user-line me-1"></i>Dr. Sarah Johnson
                                        <i class="ri-time-line ms-3 me-1"></i>Ordered: 2 hours ago
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 text-center">
                            <span class="badge bg-danger mb-2">STAT</span>
                            <div class="text-danger fw-semibold">Due: 30 min</div>
                        </div>
                        <div class="col-md-3 text-end">
                            <div class="d-grid gap-1">
                                <button class="btn btn-sm btn-danger">Process Now</button>
                                <button class="btn btn-sm btn-outline-primary">View Details</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Priority Test 2 -->
                <div class="test-item border border-warning rounded-4 p-3">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <div class="d-flex align-items-start">
                                <div class="icon-box md bg-warning-subtle rounded-circle me-3">
                                    <i class="ri-drop-line text-warning"></i>
                                </div>
                                <div>
                                    <h6 class="mb-1">Blood Culture - Urgent</h6>
                                    <p class="text-muted mb-1">Patient: Maria Garcia (ID: P-2024-1157)</p>
                                    <small class="text-muted">
                                        <i class="ri-user-line me-1"></i>Dr. Michael Brown
                                        <i class="ri-time-line ms-3 me-1"></i>Ordered: 1 hour ago
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 text-center">
                            <span class="badge bg-warning mb-2">Urgent</span>
                            <div class="text-warning fw-semibold">Due: 2 hours</div>
                        </div>
                        <div class="col-md-3 text-end">
                            <div class="d-grid gap-1">
                                <button class="btn btn-sm btn-warning">Process Now</button>
                                <button class="btn btn-sm btn-outline-primary">View Details</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Test Results -->
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="ri-test-tube-line me-2"></i>Recent Test Results
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Test ID</th>
                                <th>Patient</th>
                                <th>Test Type</th>
                                <th>Status</th>
                                <th>Technician</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>T-2024-1156</td>
                                <td>
                                    <div>
                                        <h6 class="mb-0">John Smith</h6>
                                        <small class="text-muted">P-2024-1156</small>
                                    </div>
                                </td>
                                <td>Complete Blood Count</td>
                                <td><span class="badge bg-success">Completed</span></td>
                                <td>Tech. Alice Johnson</td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <a href="~/Lab/RequestDetails/T-2024-1156" class="btn btn-sm btn-outline-primary" title="View Details">
                                            <i class="ri-eye-line"></i>
                                        </a>
                                        <a href="~/Lab/Reports?testId=T-2024-1156" class="btn btn-sm btn-outline-success" title="View Report">
                                            <i class="ri-file-text-line"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>T-2024-1157</td>
                                <td>
                                    <div>
                                        <h6 class="mb-0">Maria Garcia</h6>
                                        <small class="text-muted">P-2024-1157</small>
                                    </div>
                                </td>
                                <td>Lipid Profile</td>
                                <td><span class="badge bg-info">In Progress</span></td>
                                <td>Tech. Bob Wilson</td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <a href="~/Lab/RequestDetails/T-2024-1157" class="btn btn-sm btn-outline-primary" title="View Details">
                                            <i class="ri-eye-line"></i>
                                        </a>
                                        <a href="~/Lab/ResultEntry?testId=T-2024-1157" class="btn btn-sm btn-outline-warning" title="Enter Results">
                                            <i class="ri-edit-line"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>T-2024-1158</td>
                                <td>
                                    <div>
                                        <h6 class="mb-0">David Lee</h6>
                                        <small class="text-muted">P-2024-1158</small>
                                    </div>
                                </td>
                                <td>Urine Analysis</td>
                                <td><span class="badge bg-warning">Pending</span></td>
                                <td>Tech. Carol Davis</td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <a href="~/Lab/RequestDetails/T-2024-1158" class="btn btn-sm btn-outline-primary" title="View Details">
                                            <i class="ri-eye-line"></i>
                                        </a>
                                        <a href="~/Lab/ResultEntry?testId=T-2024-1158" class="btn btn-sm btn-outline-success" title="Start Test">
                                            <i class="ri-play-line"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        @* <!-- Workload Distribution -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="ri-team-line me-2"></i>Technician Workload
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="technician-card border rounded-4 p-3">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div class="d-flex align-items-center">
                                    <img src="~/theme/images/tech1.png" class="img-2x rounded-circle me-2" alt="Technician">
                                    <div>
                                        <h6 class="mb-0">Alice Johnson</h6>
                                        <small class="text-muted">Senior Technician</small>
                                    </div>
                                </div>
                                <span class="badge bg-success">Available</span>
                            </div>
                            <div class="progress mb-2" style="height: 8px;">
                                <div class="progress-bar bg-success" style="width: 65%"></div>
                            </div>
                            <div class="d-flex justify-content-between">
                                <small class="text-muted">Current Load: 13/20</small>
                                <small class="text-success">65%</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="technician-card border rounded-4 p-3">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div class="d-flex align-items-center">
                                    <img src="~/theme/images/tech2.png" class="img-2x rounded-circle me-2" alt="Technician">
                                    <div>
                                        <h6 class="mb-0">Bob Wilson</h6>
                                        <small class="text-muted">Lab Technician</small>
                                    </div>
                                </div>
                                <span class="badge bg-warning">Busy</span>
                            </div>
                            <div class="progress mb-2" style="height: 8px;">
                                <div class="progress-bar bg-warning" style="width: 85%"></div>
                            </div>
                            <div class="d-flex justify-content-between">
                                <small class="text-muted">Current Load: 17/20</small>
                                <small class="text-warning">85%</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div> *@
    </div>

    <div class="col-xl-4">
        <!-- Today's Schedule -->
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="ri-calendar-line me-2"></i>Today's Schedule
                </h5>
            </div>
            <div class="card-body">
                <div class="schedule-item d-flex align-items-center mb-3">
                    <div class="icon-box sm bg-primary-subtle rounded-circle me-2">
                        <i class="ri-time-line text-primary"></i>
                    </div>
                    <div>
                        <h6 class="mb-0">Morning Shift</h6>
                        <small class="text-muted">8:00 AM - 4:00 PM</small>
                        <div class="text-success fw-semibold">15 Tests Scheduled</div>
                    </div>
                </div>
                <div class="schedule-item d-flex align-items-center mb-3">
                    <div class="icon-box sm bg-warning-subtle rounded-circle me-2">
                        <i class="ri-time-line text-warning"></i>
                    </div>
                    <div>
                        <h6 class="mb-0">Evening Shift</h6>
                        <small class="text-muted">4:00 PM - 12:00 AM</small>
                        <div class="text-warning fw-semibold">8 Tests Scheduled</div>
                    </div>
                </div>
                <div class="schedule-item d-flex align-items-center">
                    <div class="icon-box sm bg-info-subtle rounded-circle me-2">
                        <i class="ri-time-line text-info"></i>
                    </div>
                    <div>
                        <h6 class="mb-0">Night Shift</h6>
                        <small class="text-muted">12:00 AM - 8:00 AM</small>
                        <div class="text-info fw-semibold">3 Emergency Tests</div>
                    </div>
                </div>
            </div>
        </div>

        @* <!-- Equipment Status -->
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="ri-settings-line me-2"></i>Equipment Status
                </h5>
            </div>
            <div class="card-body">
                <div class="equipment-item d-flex justify-content-between align-items-center mb-3">
                    <div class="d-flex align-items-center">
                        <div class="icon-box sm bg-success-subtle rounded-circle me-2">
                            <i class="ri-microscope-line text-success"></i>
                        </div>
                        <div>
                            <h6 class="mb-0">Hematology Analyzer</h6>
                            <small class="text-muted">Station A</small>
                        </div>
                    </div>
                    <span class="badge bg-success">Online</span>
                </div>
                <div class="equipment-item d-flex justify-content-between align-items-center mb-3">
                    <div class="d-flex align-items-center">
                        <div class="icon-box sm bg-warning-subtle rounded-circle me-2">
                            <i class="ri-test-tube-line text-warning"></i>
                        </div>
                        <div>
                            <h6 class="mb-0">Chemistry Analyzer</h6>
                            <small class="text-muted">Station B</small>
                        </div>
                    </div>
                    <span class="badge bg-warning">Maintenance</span>
                </div>
                <div class="equipment-item d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <div class="icon-box sm bg-success-subtle rounded-circle me-2">
                            <i class="ri-flask-line text-success"></i>
                        </div>
                        <div>
                            <h6 class="mb-0">Immunoassay System</h6>
                            <small class="text-muted">Station C</small>
                        </div>
                    </div>
                    <span class="badge bg-success">Online</span>
                </div>
            </div>
        </div> *@

        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="ri-dashboard-line me-2"></i>Quick Actions
                </h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="~/Lab/ResultEntry" class="btn btn-outline-success">
                        <i class="ri-add-line me-2"></i>New Test Entry
                    </a>
                    <a href="~/Lab/TestRequests" class="btn btn-outline-primary">
                        <i class="ri-file-list-line me-2"></i>View Requests
                    </a>
                    <a href="~/Lab/Services" class="btn btn-outline-info">
                        <i class="ri-service-line me-2"></i>Manage Services
                    </a>
                    <a href="~/Lab/Reports" class="btn btn-outline-warning">
                        <i class="ri-file-chart-line me-2"></i>View Reports
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Priority test actions
            document.querySelectorAll('.test-item button').forEach(btn => {
                btn.addEventListener('click', function() {
                    const action = this.textContent.trim();
                    const testName = this.closest('.test-item').querySelector('h6').textContent;
                    
                    switch(true) {
                        case action.includes('Process Now'):
                            alert(`Processing ${testName} immediately...`);
                            break;
                        case action.includes('View Details'):
                            alert(`Opening details for ${testName}...`);
                            break;
                    }
                });
            });
            
            // Table actions
            document.querySelectorAll('.table button').forEach(btn => {
                btn.addEventListener('click', function() {
                    const row = this.closest('tr');
                    const testId = row.cells[0].textContent;
                    const icon = this.querySelector('i').className;
                    
                    if (icon.includes('eye')) {
                        alert(`Viewing test ${testId}...`);
                    } else if (icon.includes('send')) {
                        alert(`Sending results for test ${testId}...`);
                    } else if (icon.includes('edit')) {
                        alert(`Editing test ${testId}...`);
                    } else if (icon.includes('play')) {
                        alert(`Starting test ${testId}...`);
                    }
                });
            });
            
            // Quick actions
            document.querySelectorAll('.card:last-child .btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const action = this.textContent.trim();
                    
                    switch(true) {
                        case action.includes('New Test Entry'):
                            alert('Opening new test entry form...');
                            break;
                        case action.includes('Upload Results'):
                            alert('Opening result upload interface...');
                            break;
                        case action.includes('Search Tests'):
                            alert('Opening test search interface...');
                            break;
                        case action.includes('Send Notifications'):
                            alert('Opening notification center...');
                            break;
                    }
                });
            });
        });
    </script>
}
